<form #form="ngForm" (ngSubmit)="send(form)" class="needs-validation">
    <div class="form-row">
        <div class="form-group col-sm-12" 
            [class.col-lg-6]="!novaCarteiraSetup" 
            [class.col-md-6]="!novaCarteiraSetup" 
            [class.col-lg-4]="novaCarteiraSetup" 
            [class.col-md-4]="novaCarteiraSetup">
            <label for="carteiraSetup_Id">Carteira Setup: <span class="text-danger">*</span></label>
            <select 
                    class="form-control"
                    id="carteiraSetup_Id"
                    name="carteiraSetup_Id"
                    #carteiraSetup_Id="ngModel"
                    [(ngModel)]="objeto.carteiraSetup_Id"
                    [required]="carteiraSetup_Id.touched == true && !novaCarteiraSetup"
                    (change)="carteiraSetupChange()">
                <option [ngValue]="undefined">Selecione</option>
                <option [ngValue]="item.id" *ngFor="let item of carteirasSetup">{{item.nome}}</option>
            </select>
            <p>Não encontrou a opção desejada? Clique <label for="carteiraSetup" class="link d-inline" (click)="novaCarteira()">aqui</label></p>
        </div>
        <div class="form-group col-lg-6 col-md-6 col-sm-12" [class.d-none]="!novaCarteiraSetup"
                [class.fade-out-left]="!novaCarteiraSetup"  
                [class.fade-in-right]="novaCarteiraSetup" >
            <label for="nome">Adicionar Carteira Setup: <span class="text-danger">*</span></label>
            <input type="text" 
                class="form-control"
                id="nome"
                name="nome"
                #nome="ngModel"
                [(ngModel)]="objeto.nome"
                [required]="nome.touched == true && !novaCarteiraSetup">
        </div>
        <div class="form-group col-sm-12" 
            [class.col-lg-6]="!novaCarteiraSetup" 
            [class.col-md-6]="!novaCarteiraSetup" 
            [class.col-lg-2]="novaCarteiraSetup" 
            [class.col-md-2]="novaCarteiraSetup">
            <label for="percentual">Percentual: <span class="text-danger">*</span></label>
            <input 
                class="form-control"
                id="percentual"
                name="percentual"
                mask="separator"
                thousandSeparator="."
                decimalMarker=","
                suffix="%"
                #percentual="ngModel"
                [(ngModel)]="objeto.percentual"
                required>
        </div>
    </div>
    <div class="form-row container border bg-light">
        <div class="form-group col-lg-4 col-md-4 col-sm-12 mt-2">
            <label for="produto">Produto: <span class="text-danger">*</span></label>
            <select 
                    class="form-control"
                    id="produto"
                    name="produto"
                    #_produto="ngModel"
                    [(ngModel)]="produto">
                <option [ngValue]="undefined">Selecione</option>
                <option [ngValue]="item" *ngFor="let item of (empresa.produto ?? [])">{{ item.descricao }}</option>
            </select>
        </div>
        <div class="form-group col-lg-4 col-md-4 col-sm-12 mt-2">
            <label for="tributacao">Tributação: <span class="text-danger">*</span></label>
            <select 
                    class="form-control"
                    id="tributacao"
                    name="tributacao"
                    #_tributacao="ngModel"
                    [(ngModel)]="tributacao">
                <option [ngValue]="undefined">Selecione</option>
                <option [ngValue]="item" *ngFor="let item of (produto != undefined ? produto.tributacao : [])">{{ item.descricao }}</option>
            </select>
        </div>
        <div class="form-group mt-2 px-2" style="max-width: 200px;"
            [class.fade-out-left]="!tributacao"  
            [class.fade-in-right]="tributacao" >
            <label for="aliquota">Alíquota: <span class="text-danger">*</span></label>
            <input type="text" 
                class="form-control"
                id="aliquota"
                name="aliquota"
                mask="separator"
                thousandSeparator="."
                decimalMarker=","
                suffix="%"
                #aliquota
                [value]="tributacao != undefined ? tributacao!.aliquota + ' %': ''"
                readonly>
        </div>
        <button type="button" class="btn btn-grey d-flex ml-auto align-self-center mt-2" (click)="adicionarProduto()">Adicionar</button>
    </div>

    <div class="bg-light border mt-3 mb-0 px-3" *ngIf="objeto.produtoTributacaoRel.length > 0">
        <h6 class="mt-3 mb-2">Itens selecionados</h6>
       <div class="overflow-x-auto w-100">
        <table class="table table-striped table-borderless">
            <thead>
                <tr>
                    <th class="bg-dark text-white font-weight-normal"></th>
                    <th class="bg-dark text-white font-weight-normal">Id</th>
                    <th class="bg-dark text-white font-weight-normal">Produto</th>
                    <th class="bg-dark text-white font-weight-normal">Tributação</th>
                    <th class="bg-dark text-white font-weight-normal">Alíquota</th>
                    <th class="bg-dark text-white font-weight-normal"></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of objeto.produtoTributacaoRel">
                    <td></td>
                    <td>{{item.id}}</td>
                    <td>{{item.produto.descricao}}</td>
                    <td>{{item.tributacao.descricao}}</td>
                    <td>{{item.tributacao.aliquota}}</td>
                    <td>
                        <button class="btn btn-small btn-trash ml-auto d-block px-0 text-dark" (click)="removeItem(item.id)">
                            <fa-icon [icon]="faTrashAlt"></fa-icon>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
       </div>
    </div>
    <div class="d-flex p-0 mt-3">
        <div *ngIf="erro || form.invalid" class="m-0">
            <p class="text-red" *ngFor="let err of erro">{{err}}</p>
            <p *ngIf="form.invalid && erro.length == 0" class="text-red">Preencha todos os campos obrigatórios (*) corretamente para salvar</p>
        </div>
        <button class="btn btn-primary mr-0 ml-auto" [disabled]="form.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span> Salvar </button>
    </div>
</form>
<ng-template #campoObrigatorio>
    <div class="py-3 px-4"> Este campo é obrigatório </div>
</ng-template>