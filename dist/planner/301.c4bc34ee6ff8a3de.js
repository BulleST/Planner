"use strict";(self.webpackChunkplanner=self.webpackChunkplanner||[]).push([[301],{4458:(B,j,r)=>{r.d(j,{G:()=>U});var E=r(801),t=r(6025),M=r(9205),S=r(9243),p=r(4650),D=r(8627),I=r(7549),l=r(7185),Z=r(3389),d=r(3868);let U=(()=>{class x{constructor(R,a,f,c,m){this.activatedRoute=R,this.modal=a,this.setupService=f,this.toastr=c,this.crypto=m,this.faTimes=E.NBC,this.faWallet=E.X5K,this.faChevronLeft=E.A35,this.modalOpen=!1,this.objeto=new t.Wj,this.erro=[],this.loading=!1,this.url="",this.url=this.activatedRoute.snapshot.pathFromRoot.map(h=>h.routeConfig?.path).join("/"),this.url.includes("empresas/editar")&&R.parent?.parent?.params.subscribe(h=>{h.empresa_id?this.objeto.empresa_Id=this.crypto.decrypt(h.empresa_id):this.voltar()})}ngOnInit(){}voltar(){this.modal.voltar()}resetForm(){this.objeto=new t.Wj,this.setupService.setObject(new t.Wj)}send(R){this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")?(this.setupService.add_To_Empresa_List(this.objeto)&&(this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.voltar()),this.loading=!1):(this.url.includes("empresas/editar"),this.setupService.create(this.objeto).subscribe({next:a=>{this.modal.voltar(),this.setupService.getList().subscribe()},error:a=>{this.loading=!1}}))}}return x.\u0275fac=function(R){return new(R||x)(p.Y36(D.gz),p.Y36(I.Q),p.Y36(M.A),p.Y36(l._W),p.Y36(S.w))},x.\u0275cmp=p.Xpm({type:x,selectors:[["app-create"]],decls:13,vars:4,consts:[[1,"modal__content"],[1,"modal__header","pb-2",2,"padding","0 25px"],[1,"link","text-dark",3,"click"],[1,"mr-1",3,"icon"],[1,"text-orange","mt-2"],[1,"btn","btn-yellow",3,"click"],[1,"modal__body","mt-0"],[3,"objeto","loading","erro","sendData"]],template:function(R,a){1&R&&(p.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),p.NdJ("click",function(){return a.voltar()}),p._UZ(4,"fa-icon",3),p._uU(5," Voltar "),p.qZA(),p.TgZ(6,"h3",4),p._uU(7,"Adicionar carteira setup"),p.qZA()(),p.TgZ(8,"button",5),p.NdJ("click",function(){return a.resetForm()}),p._uU(9,"Limpar campos"),p.qZA()(),p.TgZ(10,"div",6)(11,"app-form-carteira-setup",7),p.NdJ("sendData",function(c){return a.send(c)}),p.qZA()()(),p._UZ(12,"router-outlet")),2&R&&(p.xp6(4),p.Q6J("icon",a.faChevronLeft),p.xp6(7),p.Q6J("objeto",a.objeto)("loading",a.loading)("erro",a.erro))},dependencies:[D.lC,Z.U,d.BN]}),x})()},4115:(B,j,r)=>{r.d(j,{T:()=>R});var E=r(5861),t=r(801),M=r(9808),S=r(6025),p=r(8913),D=r(9205),I=r(9243),l=r(4650),Z=r(8627),d=r(7549),U=r(6895);function x(a,f){1&a&&(l.TgZ(0,"p")(1,"small"),l._uU(2,"Obs.: Se esse setup estiver relacionado a um planner, ele ser\xe1 apenas desativado, possibilitando futuras consultas. Se n\xe3o, esse setup ser\xe1 definitivamente removido."),l.qZA()())}function P(a,f){1&a&&l._UZ(0,"span",11)}let R=(()=>{class a{constructor(c,m,h,_,v){this.activatedRoute=c,this.modal=m,this.empresaService=h,this.setupService=_,this.crypto=v,this.faTimes=t.NBC,this.modalOpen=!1,this.erro=[],this.loading=!1,this.url="",this.objeto=new S.Wj,this.modal.getOpen().subscribe(b=>{this.modalOpen=b}),this.url=this.activatedRoute.snapshot.pathFromRoot.map(b=>b.routeConfig?.path).join("/"),c.params.subscribe(b=>{b.setup_id?this.objeto.id=this.crypto.decrypt(b.setup_id):this.voltar()}),(this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo)&&(this.objeto=this.empresaService.empresaObject.value.carteiraSetup.find(b=>b.id==this.objeto.id))}ngOnInit(){setTimeout(()=>{this.modal.setOpen(!0)},200)}voltar(){this.modal.voltar()}send(){var m,c=this;this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?(this.setupService.delete_To_Empresa_List(this.objeto.id)&&this.voltar(),this.loading=!1):this.setupService.delete(this.objeto.id).subscribe({next:(m=(0,E.Z)(function*(h){yield(0,M.n)(c.setupService.getList()),c.voltar(),c.setupService.setObject(new S.Wj)}),function(_){return m.apply(this,arguments)}),error:m=>{this.loading=!1}})}}return a.\u0275fac=function(c){return new(c||a)(l.Y36(Z.gz),l.Y36(d.Q),l.Y36(p.P),l.Y36(D.A),l.Y36(I.w))},a.\u0275cmp=l.Xpm({type:a,selectors:[["app-delete"]],decls:17,vars:4,consts:[[1,"modal"],[1,"modal__bg",3,"click"],[1,"modal__inner",2,"max-width","600px"],[1,"modal__content"],[1,"modal__header","pb-2"],[1,"text-orange"],[1,"modal__header-close","btn-close",3,"click"],[1,"modal__body","mt-0"],[4,"ngIf"],[1,"btn","btn-grey","ml-auto","d-flex","mt-2",3,"click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(c,m){1&c&&(l.TgZ(0,"div",0)(1,"div",1),l.NdJ("click",function(){return m.voltar()}),l.qZA(),l.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),l._uU(6,"Excluir setup"),l.qZA(),l.TgZ(7,"a",6),l.NdJ("click",function(){return m.voltar()}),l._UZ(8,"span")(9,"span"),l.qZA()(),l.TgZ(10,"div",7)(11,"p"),l._uU(12,"Tem certeza que deseja excluir esse setup? Essa opera\xe7\xe3o n\xe3o poder\xe1 ser desfeita!!"),l.qZA(),l.YNc(13,x,3,0,"p",8),l.TgZ(14,"button",9),l.NdJ("click",function(){return m.send()}),l.YNc(15,P,1,0,"span",10),l._uU(16," Excluir "),l.qZA()()()()()),2&c&&(l.ekj("active",m.modalOpen),l.xp6(13),l.Q6J("ngIf",!m.objeto.registroNaoSalvo),l.xp6(2),l.Q6J("ngIf",m.loading))},dependencies:[U.O5]}),a})()},5623:(B,j,r)=>{r.d(j,{F:()=>f});var E=r(5861),t=r(801),M=r(9808),S=r(6025),p=r(8913),D=r(9885),I=r(1286),l=r(9205),Z=r(9243),d=r(4650),U=r(8627),x=r(7185),P=r(7549),R=r(3389),a=r(3868);let f=(()=>{class c{constructor(h,_,v,b,C,L,y,W){this.activatedRoute=h,this.toastr=_,this.modal=v,this.crypto=b,this.setupService=C,this.setupRelService=L,this.empresaService=y,this.produtoService=W,this.faTimes=t.NBC,this.faChevronLeft=t.A35,this.objeto=new S.Wj,this.erro=[],this.loading=!1,this.loadingProduto=!1,this.url="",this.url=this.activatedRoute.snapshot.pathFromRoot.map(A=>A.routeConfig?.path).join("/"),h.params.subscribe(A=>{A.setup_id?this.objeto.id=this.crypto.decrypt(A.setup_id):this.voltar()}),this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?this.objeto=this.empresaService.empresaObject.value.carteiraSetup.find(A=>A.id==this.objeto.id):this.setupService.get(this.objeto.id).subscribe({next:A=>{this.objeto=A},error:A=>{this.voltar()}})}ngOnInit(){setTimeout(()=>{this.modal.setOpen(!0)},200)}voltar(){this.modal.voltar()}resetForm(){this.objeto=new S.Wj,this.setupService.setObject(new S.Wj)}send(h){var v,_=this;this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?(this.setupService.edit_To_Empresa_List(this.objeto)&&(this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.voltar()),this.loading=!1):(this.url.includes("empresas/editar"),this.setupService.edit(this.objeto).subscribe({next:(v=(0,E.Z)(function*(b){yield(0,M.n)(_.setupService.getList()),_.modal.voltar()}),function(C){return v.apply(this,arguments)}),error:v=>{this.loading=!1},complete:()=>{}}))}}return c.\u0275fac=function(h){return new(h||c)(d.Y36(U.gz),d.Y36(x._W),d.Y36(P.Q),d.Y36(Z.w),d.Y36(l.A),d.Y36(I.C),d.Y36(p.P),d.Y36(D.m))},c.\u0275cmp=d.Xpm({type:c,selectors:[["app-edit"]],decls:13,vars:4,consts:[[1,"modal__content"],[1,"modal__header","pb-2",2,"padding","0 25px"],[1,"link","text-dark",3,"click"],[1,"mr-1",3,"icon"],[1,"text-orange","mt-2"],[1,"btn","btn-yellow",3,"click"],[1,"modal__body","mt-0"],[3,"objeto","loading","erro","sendData"]],template:function(h,_){1&h&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),d.NdJ("click",function(){return _.voltar()}),d._UZ(4,"fa-icon",3),d._uU(5," Voltar "),d.qZA(),d.TgZ(6,"h3",4),d._uU(7,"Editar carteira setup"),d.qZA()(),d.TgZ(8,"button",5),d.NdJ("click",function(){return _.resetForm()}),d._uU(9,"Limpar campos"),d.qZA()(),d.TgZ(10,"div",6)(11,"app-form-carteira-setup",7),d.NdJ("sendData",function(b){return _.send(b)}),d.qZA()()(),d._UZ(12,"router-outlet")),2&h&&(d.xp6(4),d.Q6J("icon",_.faChevronLeft),d.xp6(7),d.Q6J("objeto",_.objeto)("loading",_.loading)("erro",_.erro))},dependencies:[U.lC,R.U,a.BN]}),c})()},1286:(B,j,r)=>{r.d(j,{C:()=>x});var E=r(1135),t=r(4004),M=r(9243),S=r(2340),p=r(9398),D=r(8913),I=r(46),l=r(6025),Z=r(4650),d=r(529),U=r(7185);let x=(()=>{class P{constructor(a,f,c,m,h){this.table=a,this.http=f,this.toastr=c,this.crypto=m,this.empresaService=h,this.url=S.N.url,this.list=new E.X([]),this.objeto=new E.X(void 0),this.carteiraSetup=new E.X([]),this.empresa=new p.oW,this.empresaService.empresaObject.subscribe(_=>{this.empresa=_})}getObject(){let a=localStorage.getItem("setup");return a&&this.setObject(this.crypto.decrypt(a)??new l.Wj),this.objeto}setObject(a){localStorage.setItem("setup",this.crypto.encrypt(a)??""),this.setObject(a)}add_To_Empresa_List(a){if(0==a.carteiraProdutoRel.length)return this.toastr.error("Insira pelo menos uma combina\xe7\xe3o entre produto e tributa\xe7\xe3o."),!1;if(this.empresa){let m=this.empresaService.object.carteiraSetup;m.sort((C,L)=>C.id-L.id);let v,h=0,_=this.empresa.carteiraSetup.findIndex(C=>C.id==a.id);-1==_?(h=0==m.length?0:m[m.length-1].id,v={id:++h,nome:a.nome??"",empresa_Id:a.empresa_Id,carteiraRiscoRel:[],carteiraProdutoRel:[]}):(v=this.empresa.carteiraSetup[_],v.carteiraProdutoRel=[]);var f=this.empresa.carteiraSetup.map(C=>C.carteiraProdutoRel),c=[].concat.apply([],f);c.sort((C,L)=>C.id-L.id);let b=0==c.length?0:c[c.length-1].id;for(let C of a.carteiraProdutoRel)if(!this.empresa.carteiraSetup.find(y=>{var W=y.nome.toLowerCase()==a.nome.toLowerCase()&&y.id!=a.id||y.id==a.id,A=c.map(F=>F.produtoTributacaoRel).find(F=>F.produto_Id==C.produtoTributacaoRel.produto_Id&&F.tributacao_Id==C.produtoTributacaoRel.tributacao_Id);return W&&A})){let y={id:++b,carteiraSetup_Id:v.id,percentual:0,produtoTributacaoRel_Id:0,produtoTributacaoRel:C.produtoTributacaoRel};v.carteiraProdutoRel.push(y)}return-1==_?(a.registroNaoSalvo=!0,this.empresa.carteiraSetup.push(v)):this.empresa.carteiraSetup.splice(_,1,v),this.empresaService.setObject(this.empresa),this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.table.resetSelection(),!0}return this.toastr.error("Nenhuma empresa selecionada."),!1}delete_To_Empresa_List(a){if(this.empresa){let f=this.empresa.carteiraSetup??[],c=f.findIndex(m=>m.id==a);return-1!=c?(f.splice(c,1),this.empresa.carteiraSetup=f,this.empresaService.setObject(this.empresa),this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.table.resetSelection(),!0):(this.toastr.error("Setup n\xe3o encontrado!!"),!1)}return this.toastr.error("Nenhuma empresa selecionada."),!1}getList(a=1){return this.http.get(`${this.url}/carteiraProdutoRel/all/${a}`).pipe((0,t.U)(f=>(this.list.next(f),f)))}get(a){return this.http.get(`${this.url}/carteiraSetup/${a}`)}create(a){return this.http.post(`${this.url}/carteiraSetup/`,a)}edit(a){}delete(a){}}return P.\u0275fac=function(a){return new(a||P)(Z.LFG(I.i),Z.LFG(d.eN),Z.LFG(U._W),Z.LFG(M.w),Z.LFG(D.P))},P.\u0275prov=Z.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},3389:(B,j,r)=>{r.d(j,{U:()=>nt});var E=r(5861),t=r(4650),M=r(801),S=r(6025),p=r(8913),D=r(9205),I=r(8259),l=r(1956),d=[{field:"id",header:"Id",filterType:l.vA.text,filterDisplay:l.w2.menu,maskType:l.O.undefined},{field:"tipoRisco.nome",header:"Tipo de Risco",filterType:l.vA.text,filterDisplay:l.w2.menu,maskType:l.O.undefined},{field:"percentual",header:"Percentual",filterType:l.vA.numeric,filterDisplay:l.w2.menu,maskType:l.O.percentage,decimal:"1.2"}],U=r(9243),x=r(316),P=r(9535),R=r(9885),a=r(9808),f=r(4551),c=r(7185),m=r(8627),h=r(6895),_=r(433),v=r(3868),b=r(805),C=r(1094),L=r(2210),y=r(9364);const W=["chartProdutos"];function A(s,g){if(1&s){const e=t.EpF();t.TgZ(0,"div",46)(1,"input",47,48),t.NdJ("ngModelChange",function(i){t.CHM(e);const u=t.oxw();return t.KtG(u.selectedRisco=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.tipoRiscoChange())}),t.qZA(),t.TgZ(3,"label",49),t._uU(4),t.qZA()()}if(2&s){const e=g.$implicit,o=t.oxw();t.xp6(1),t.MGl("id","tipoRisco-",e.nome,""),t.Q6J("ngModel",o.selectedRisco)("value",e)("checked",e.id==o.selectedRisco.id),t.xp6(2),t.MGl("for","tipoRisco-",e.nome,""),t.xp6(1),t.Oqu(e.nome)}}function F(s,g){if(1&s&&(t.TgZ(0,"div",51)(1,"div"),t._uU(2),t.qZA()()),2&s){const e=t.oxw(2);t.xp6(2),t.Oqu(e.produto.descricao)}}function w(s,g){if(1&s&&t.YNc(0,F,3,1,"div",50),2&s){const e=t.oxw();t.Q6J("ngIf",e.produto)}}function Y(s,g){if(1&s&&(t.TgZ(0,"div",52)(1,"div")(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"p")(5,"strong"),t._uU(6,"Tipo Risco:"),t.qZA(),t._uU(7),t.qZA()()()),2&s){const e=g.$implicit;t.xp6(3),t.Oqu(e.descricao),t.xp6(4),t.hij(" ",e.tipoRisco.nome,"")}}function Q(s,g){1&s&&(t.TgZ(0,"p",8),t._uU(1,"Selecione um risco para continuar."),t.qZA())}function q(s,g){if(1&s&&(t.TgZ(0,"p",8),t._uU(1),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.hij("Nenhum produto para ",e.selectedRisco.nome,".")}}function G(s,g){if(1&s&&(t.TgZ(0,"div",51)(1,"div"),t._uU(2),t.qZA()()),2&s){const e=t.oxw(2);t.xp6(2),t.Oqu(e.produtoTributacaoRel.tributacao.descricao)}}function $(s,g){if(1&s&&t.YNc(0,G,3,1,"div",50),2&s){const e=t.oxw();t.Q6J("ngIf",e.produtoTributacaoRel)}}function k(s,g){if(1&s&&(t.TgZ(0,"div",52)(1,"div")(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"p")(5,"strong"),t._uU(6,"Al\xedquota:"),t.qZA(),t._uU(7),t.ALo(8,"currency"),t.qZA()()()),2&s){const e=g.$implicit;t.xp6(3),t.Oqu(e.tributacao.descricao),t.xp6(4),t.hij(" ",t.gM2(8,2,e.tributacao.aliquota,"BRL","","1.0-2"),"")}}function z(s,g){1&s&&(t.TgZ(0,"p",8),t._uU(1,"Informe o percentual"),t.qZA())}function H(s,g){if(1&s&&(t.TgZ(0,"p",8),t._uU(1),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.hij("Valor m\xe1ximo dispon\xedvel \xe9 ",e.selectedRisco.percentualDisponivel,"%")}}function V(s,g){if(1&s){const e=t.EpF();t.TgZ(0,"tr"),t._UZ(1,"td"),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"mask"),t.qZA(),t.TgZ(13,"td")(14,"input",58,38),t.NdJ("ngModelChange",function(i){const n=t.CHM(e).$implicit;return t.KtG(n.percentual=i)})("change",function(){t.CHM(e);const i=t.oxw(2);return i.calcularPercentuais(),t.KtG(i.setChartProduto(""))}),t.qZA()(),t.TgZ(16,"td")(17,"button",59),t.NdJ("click",function(){const u=t.CHM(e).$implicit,n=t.oxw(2);return t.KtG(n.removeProduto(u))}),t._UZ(18,"fa-icon",60),t.TgZ(19,"span",61),t._uU(20,"Excluir"),t.qZA()()()()}if(2&s){const e=g.$implicit,o=g.index,i=t.oxw(2);let u,n;t.ekj("selected",e.produtoTributacaoRel.produto.tipoRisco_Id==i.selectedRisco.id),t.xp6(3),t.Oqu(e.id),t.xp6(2),t.Oqu(null==e.produtoTributacaoRel.produto.tipoRisco?null:e.produtoTributacaoRel.produto.tipoRisco.nome),t.xp6(2),t.Oqu(e.produtoTributacaoRel.produto.descricao),t.xp6(2),t.Oqu(e.produtoTributacaoRel.tributacao.descricao),t.xp6(2),t.hij("",t.Dn7(12,13,e.produtoTributacaoRel.tributacao.aliquota,"separator","."),"%"),t.xp6(3),t.MGl("id","percentual-",o,"")("name","percentual-",o,""),t.Q6J("max",null==(u=i.getRisco(e.produtoTributacaoRel.produto.tipoRisco_Id))?null:u.percentualDisponivel)("placeholder",(null==(n=i.getRisco(e.produtoTributacaoRel.produto.tipoRisco_Id))?null:n.percentualDisponivel)+"% dispon\xedvel")("ngModel",e.percentual),t.xp6(4),t.Q6J("icon",i.faTrashAlt)}}function X(s,g){if(1&s&&(t.TgZ(0,"div",53)(1,"p",19),t._uU(2,"Itens selecionados"),t.qZA(),t.TgZ(3,"div",54)(4,"table",55)(5,"thead")(6,"tr"),t._UZ(7,"th",56),t.TgZ(8,"th",56),t._uU(9,"Id"),t.qZA(),t.TgZ(10,"th",56),t._uU(11,"Risco"),t.qZA(),t.TgZ(12,"th",56),t._uU(13,"Produto"),t.qZA(),t.TgZ(14,"th",56),t._uU(15,"Tributa\xe7\xe3o"),t.qZA(),t.TgZ(16,"th",56),t._uU(17,"Al\xedquota"),t.qZA(),t.TgZ(18,"th",56),t._uU(19,"Percentual"),t.qZA(),t._UZ(20,"th",56),t.qZA()(),t.TgZ(21,"tbody"),t.YNc(22,V,21,17,"tr",57),t.qZA()()()()),2&s){const e=t.oxw();t.xp6(22),t.Q6J("ngForOf",e.objeto.carteiraProdutoRel)}}function tt(s,g){if(1&s&&(t.TgZ(0,"p",65),t._uU(1),t.qZA()),2&s){const e=g.$implicit;t.xp6(1),t.Oqu(e)}}function et(s,g){1&s&&(t.TgZ(0,"p",65),t._uU(1,"Preencha todos os campos obrigat\xf3rios (*) corretamente para salvar"),t.qZA())}function ot(s,g){if(1&s&&(t.TgZ(0,"div",62),t.YNc(1,tt,2,1,"p",63),t.YNc(2,et,2,0,"p",64),t.qZA()),2&s){const e=t.oxw(),o=t.MAs(1);t.xp6(1),t.Q6J("ngForOf",e.erro),t.xp6(1),t.Q6J("ngIf",o.invalid&&0==e.erro.length)}}function rt(s,g){1&s&&t._UZ(0,"span",66)}function it(s,g){1&s&&(t.TgZ(0,"div",67),t._uU(1," Este campo \xe9 obrigat\xf3rio "),t.qZA())}const at=function(){return[]};let nt=(()=>{class s{constructor(e,o,i,u,n,O,K,N){this.toastr=e,this.empresaService=o,this.produtoService=i,this.activatedRoute=u,this.setupService=n,this.dropdown=O,this.router=K,this.crypto=N,this.objeto=new S.Wj,this.loading=!1,this.erro=[],this.sendData=new t.vpe,this.produtos=[],this.carteirasSetup=[],this.faPlus=M.r8p,this.faTrashAlt=M.I7k,this.faChartSimple=M.Wpq,this.faTable=M.B3e,this.faEdit=M.Xcf,this.isEditPage=!1,this.loadingCarteiras=!0,this.loadingTributacao=!1,this.carteiraRiscoColumns=d,this.percentual="",this.tipoRiscos=[],this.cmp=(T,J)=>(T>J)-(T<J),this.chartWidth="0",this.selectedRisco=new x.p,this.url="",this.activatedRoute.params.subscribe(T=>{this.isEditPage=!!T.setup_id}),this.dropdown.tipoRisco.subscribe(T=>this.tipoRiscos=T),this.dropdown.getRisco().subscribe({next:T=>{this.selectedRisco=T[0],this.tipoRiscoChange()}}),this.url=this.activatedRoute.snapshot.pathFromRoot.map(T=>T.routeConfig?.path).join("/"),this.url.includes("empresas/cadastrar")?this.empresaService.empresaObject.subscribe(T=>{this.carteirasSetup=T.carteiraSetup,this.produtos=T.produto}):(this.setupService.getList().subscribe({next:T=>{this.carteirasSetup=T}}),this.produtoService.getList().subscribe({next:T=>{this.produtos=T}}))}ngOnInit(){}ngOnChanges(e){e.objeto&&(this.objeto=e.objeto.currentValue,this.setChartProduto("ngOnChanges"),this.validatePercentualRisco()),e.loading&&(this.loading=e.loading.currentValue),e.erro&&(this.erro=e.erro.currentValue),e.carteirasSetup&&(this.carteirasSetup=e.carteirasSetup.currentValue)}ngAfterViewInit(){var e=window.innerWidth,o=I(".chart-container").width()??0;this.chartWidth=(100/e*o).toString()+"vw"}onResize(e){var o=window.innerWidth,i=I(".chart-container").width()??0;this.chartWidth=(100/o*i).toString()+"vw"}send(e){if(e.invalid)return this.toastr.error("Campos inv\xe1lidos"),void(this.erro=["Campos inv\xe1lidos"]);this.erro=[],this.sendData.emit(e)}tipoRiscoChange(){var e=this;return(0,E.Z)(function*(){let o=[];o=e.url.includes("empresas/cadastrar")?e.empresaService.empresaObject.value.produto:yield(0,a.n)(e.produtoService.getList()),e.selectedRisco&&(e.produtos=o.filter(i=>i.tipoRisco_Id==e.selectedRisco.id)),e.percentual="",e.calcularPercentuais()})()}calcularPercentuais(){this.tipoRiscos=this.tipoRiscos.map(e=>{let o=this.objeto.carteiraProdutoRel.filter(i=>i.produtoTributacaoRel.produto.tipoRisco_Id==e.id);return e.percentualDisponivel=o.length>0?100-o.map(i=>i.percentual).reduce((i,u)=>i+u):100,e})}getRisco(e){return this.tipoRiscos.find(o=>o.id==e)}setChartProduto(e){let o=0,i=this.objeto.carteiraProdutoRel.map(n=>n.produtoTributacaoRel.produto.tipoRisco);i=i.filter((n,O,K)=>O===K.findIndex(N=>N.id===n.id)),this.optionsProduto={onClick:n=>{},indexAxis:"y",plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0,0,0,0.95)",padding:{x:15,y:10},callbacks:{beforeTitle:n=>"",title:n=>"",afterTitle:n=>n[0].element.$context.raw.produtoTributacaoRel.produto.descricao,label:n=>n.element.$context.raw.produtoTributacaoRel.tributacao.descricao,afterLabel:n=>"Al\xedquota: "+n.element.$context.raw.produtoTributacaoRel.tributacao.aliquota+"%"}}},scales:{xAxes:{stacked:!0,min:0,max:100,suggestedMax:100,scaleLabel:{display:!0},grid:{drawBorder:!1},ticks:{callback:function(n,O,K){return n+"%"}}},yAxes:{scaleLabel:{display:!0},stacked:!0,drawOnChartArea:i.length>0,drawBorder:i.length>0,display:i.length>0}},parsing:{yAxisKey:"produtoTributacaoRel.produto.tipoRisco.nome",xAxisKey:"percentual"},responsive:!0},this.objeto.carteiraProdutoRel.sort((n,O)=>this.cmp(n.produtoTributacaoRel.produto.tipoRisco_Id,O.produtoTributacaoRel.produto.tipoRisco_Id)||this.cmp(n.percentual,O.percentual));let u=this.objeto.carteiraProdutoRel.map(n=>({type:"bar",label:`${n.produtoTributacaoRel.produto.descricao} <br> ${n.produtoTributacaoRel.tributacao.descricao}`,backgroundColor:f.O[o++],data:[n]}));this.dataProduto={datasets:u},this.chartProdutos&&this.chartProdutos.chart.update()}adicionarProduto(){if(null==this.produto)this.toastr.error("Selecione um produto para adicionar");else if(null==this.produtoTributacaoRel)this.toastr.error("Selecione uma tributa\xe7\xe3o para adicionar");else{let i=Object.assign({},this.produto);i.produtoTributacaoRel=[],this.produtoTributacaoRel.produto=i,this.produtoTributacaoRel.produto_Id=i.id;let u={id:0,percentual:this.percentual,carteiraSetup_Id:0,produtoTributacaoRel_Id:this.produtoTributacaoRel.id,produtoTributacaoRel:this.produtoTributacaoRel};var e=this.objeto.carteiraProdutoRel.map(n=>n.produtoTributacaoRel).findIndex(n=>n.produto_Id==this.produto?.id&&n.tributacao_Id==this.produtoTributacaoRel?.id),o=this.objeto.carteiraProdutoRel.map(n=>n.produtoTributacaoRel).find(n=>n.produto_Id==this.produto?.id&&n.tributacao_Id==this.produtoTributacaoRel?.id);o&&-1!=e?(u.id=o.id,this.objeto.carteiraProdutoRel.splice(e,1,u)):this.objeto.carteiraProdutoRel.push(u),this.objeto.carteiraProdutoRel.sort((n,O)=>this.cmp(n.produtoTributacaoRel.produto.tipoRisco_Id,O.produtoTributacaoRel.produto.tipoRisco_Id)||this.cmp(n.percentual,O.percentual)),this.calcularPercentuais(),this.setChartProduto("adicionarProduto"),this.setupService.setObject(this.objeto),delete this.produtoTributacaoRel,delete this.produto,this.percentual=""}}removeProduto(e){let o=this.objeto.carteiraProdutoRel.findIndex(i=>i.produtoTributacaoRel.tributacao.id==e.produtoTributacaoRel.tributacao.id&&i.produtoTributacaoRel.produto.id==e.produtoTributacaoRel.produto.id);-1!=o&&(this.objeto.carteiraProdutoRel.splice(o,1),this.setupService.setObject(this.objeto),this.setChartProduto("removeProduto"),this.calcularPercentuais())}validatePercentualRisco(){let e=!1,o=[];for(let i of this.objeto.carteiraProdutoRel){let u=o.findIndex(n=>n.tipoRisco_Id==i.produtoTributacaoRel.produto.tipoRisco_Id);-1!=u?o[u].percentual+=i.percentual:o.push({tipoRisco:i.produtoTributacaoRel.produto.tipoRisco,tipoRisco_Id:i.produtoTributacaoRel.produto.tipoRisco_Id,percentual:i.percentual,id:0,carteiraSetup_Id:0})}return this.erro=o.filter(i=>100!=i.percentual).map(i=>`A soma do percentual dos produtos para cada tipo de risco ${i.tipoRisco.nome} deve ser 100%.`),this.erro.length>0&&(e=!0),e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(c._W),t.Y36(p.P),t.Y36(R.m),t.Y36(m.gz),t.Y36(D.A),t.Y36(P.V),t.Y36(m.F0),t.Y36(U.w))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-form-carteira-setup"]],viewQuery:function(e,o){if(1&e&&t.Gf(W,5),2&e){let i;t.iGM(i=t.CRH())&&(o.chartProdutos=i.first)}},hostBindings:function(e,o){1&e&&t.NdJ("resize",function(u){return o.onResize(u)},!1,t.Jf7)},inputs:{objeto:"objeto",loading:"loading",erro:"erro"},outputs:{sendData:"sendData"},features:[t.TTD],decls:79,vars:30,consts:[[1,"needs-validation",3,"ngSubmit"],["form","ngForm"],[1,"d-flex","flex-wrap","align-items-stretch","mb-2"],[1,"col-lg-12","col-md-12","col-sm-12","pl-0","pr-1"],[1,"card","card-body"],[1,"form-row"],[1,"form-group","col-sm-12"],["for","carteiraSetup",1,"h6"],[1,"text-danger"],["type","text","name","nome","id","nome","placeholder","Digite para cadastrar nova carteira",1,"form-control","my-1",3,"ngModel","ngModelChange"],["nome","ngModel"],[1,"form-row","chart-container","card","card-body"],[1,"d-flex"],[1,"d-flex","ml-auto","mt-1","mb-2"],["type","verticalBar","height","200",3,"options","data","width"],["chartProdutos",""],[1,"card","mt-2"],[1,"card-body","bg-white"],[1,"mt-2","mb-2"],[1,"h6","text-center"],[1,"d-flex","align-items-center","justify-content-center","col-sm-12"],["class","mx-2",4,"ngFor","ngForOf"],[1,"form-row","justify-content-center","mt-2"],[1,"form-group","col-lg-3","col-md-4","col-sm-12"],["for","produto"],["id","produto","name","produto","optionLabel","descricao","filterBy","descricao, tipoRisco.nome","placeholder","Selecione",1,"form-control",3,"options","ngModel","filter","showClear","ngModelChange"],["_produto","ngModel"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"mt-1","px-1"],["class","text-danger",4,"ngIf"],["for","tributacao"],["id","tributacao","name","tributacao","optionLabel","tributacao.descricao","filterBy","descricao, aliquota","placeholder","Selecione",1,"form-control",3,"disabled","ngModel","options","filter","showClear","ngModelChange"],["_tributacao","ngModel"],[1,"form-group","col-lg-4","col-md-4","col-sm-12"],["for","percentual"],[1,"col-lg-8","col-md-8","col-sm-12","pl-0"],["type","text","id","percentual","name","percentual","mask","separator","thousandSeparator",".","decimalMarker",",","suffix","%",1,"form-control",3,"max","placeholder","disabled","ngModel","ngModelChange"],["_percentual","ngModel"],["type","button",1,"btn","btn-grey",3,"disabled","click"],["class","col-lg-11 col-md-12 px-2 mx-auto",4,"ngIf"],[1,"d-flex","align-items-start","p-0","mt-3"],["class","m-0",4,"ngIf"],[1,"btn","btn-primary","mr-0","ml-auto",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["campoObrigatorio",""],[1,"mx-2"],["type","radio","name","tipoRisco",1,"mr-1","mt-1",3,"id","ngModel","value","checked","ngModelChange"],["tipoRisco","ngModel"],[3,"for"],["class","country-item country-item-value",4,"ngIf"],[1,"country-item","country-item-value"],[1,"country-item"],[1,"col-lg-11","col-md-12","px-2","mx-auto"],[1,"overflow-x-auto","w-100"],[1,"table","table-striped","table-borderless","table-editable"],[1,"bg-dark","text-white","font-weight-normal"],[3,"selected",4,"ngFor","ngForOf"],["type","text","mask","separator","thousandSeparator",".","decimalMarker",",","suffix","%",1,"form-control",3,"id","name","max","placeholder","ngModel","ngModelChange","change"],["type","button",1,"btn-trash","ml-auto","d-block","px-2","text-dark",3,"click"],[1,"d-md-none","d-sm-block",3,"icon"],[1,"d-md-block","d-sm-none","btn","btn-dark"],[1,"m-0"],["class","text-red",4,"ngFor","ngForOf"],["class","text-red",4,"ngIf"],[1,"text-red"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"py-3","px-4"]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"form",0,1),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.MAs(1);return t.KtG(o.send(n))}),t.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),t._uU(8,"Carteira: "),t.TgZ(9,"span",8),t._uU(10,"*"),t.qZA()(),t.TgZ(11,"div")(12,"input",9,10),t.NdJ("ngModelChange",function(n){return o.objeto.nome=n}),t.qZA()()()()()()(),t.TgZ(14,"div",11)(15,"div",12)(16,"div")(17,"h6"),t._uU(18,"Divis\xe3o da carteira: "),t.TgZ(19,"span",8),t._uU(20,"*"),t.qZA()(),t.TgZ(21,"p",8)(22,"small"),t._uU(23,"Clique para editar"),t.qZA()(),t._UZ(24,"div",13),t.qZA()(),t.TgZ(25,"div"),t._UZ(26,"p-chart",14,15),t.qZA()(),t.TgZ(28,"div",16)(29,"div",17)(30,"div",18)(31,"p",19),t._uU(32,"Selecione o Risco"),t.qZA(),t.TgZ(33,"div",20),t.YNc(34,A,5,6,"div",21),t.qZA()(),t.TgZ(35,"div",22)(36,"div",23)(37,"label",24),t._uU(38,"Produto: "),t.TgZ(39,"span",8),t._uU(40,"*"),t.qZA()(),t.TgZ(41,"p-dropdown",25,26),t.NdJ("ngModelChange",function(n){return o.produto=n}),t.YNc(43,w,1,1,"ng-template",27),t.YNc(44,Y,8,2,"ng-template",28),t.qZA(),t.TgZ(45,"div",29),t.YNc(46,Q,2,0,"p",30),t.YNc(47,q,2,1,"p",30),t.qZA()(),t.TgZ(48,"div",23)(49,"label",31),t._uU(50,"Tributa\xe7\xe3o: "),t.TgZ(51,"span",8),t._uU(52,"*"),t.qZA()(),t.TgZ(53,"p-dropdown",32,33),t.NdJ("ngModelChange",function(n){return o.produtoTributacaoRel=n}),t.YNc(55,$,1,1,"ng-template",27),t.YNc(56,k,9,7,"ng-template",28),t.qZA()(),t.TgZ(57,"div",34)(58,"label",35),t._uU(59,"Percentual: "),t.TgZ(60,"span",8),t._uU(61,"*"),t.qZA()(),t.TgZ(62,"div",12)(63,"div",36)(64,"input",37,38),t.NdJ("ngModelChange",function(n){return o.percentual=n}),t.qZA()(),t.TgZ(66,"button",39),t.NdJ("click",function(){return o.adicionarProduto()}),t._uU(67," Adicionar "),t.qZA()(),t.TgZ(68,"div",29),t.YNc(69,z,2,0,"p",30),t.YNc(70,H,2,1,"p",30),t.qZA()()(),t.YNc(71,X,23,1,"div",40),t.qZA()(),t.TgZ(72,"div",41),t.YNc(73,ot,3,2,"div",42),t.TgZ(74,"button",43),t.YNc(75,rt,1,0,"span",44),t._uU(76," Salvar "),t.qZA()()(),t.YNc(77,it,2,0,"ng-template",null,45,t.W1O)}if(2&e){const i=t.MAs(1),u=t.MAs(65);t.xp6(12),t.Q6J("ngModel",o.objeto.nome),t.xp6(14),t.Q6J("options",o.optionsProduto)("data",o.dataProduto)("width",o.chartWidth),t.xp6(8),t.Q6J("ngForOf",o.tipoRiscos),t.xp6(7),t.Q6J("options",o.produtos)("ngModel",o.produto)("filter",!0)("showClear",!0),t.xp6(5),t.Q6J("ngIf",null==o.selectedRisco),t.xp6(1),t.Q6J("ngIf",null!=o.selectedRisco&&0==o.produtos.length),t.xp6(6),t.ekj("p-disabled",null==o.produto),t.Q6J("disabled",null==o.produto)("ngModel",o.produtoTributacaoRel)("options",null==o.produto?t.DdM(29,at):o.produto.produtoTributacaoRel)("filter",!0)("showClear",!0),t.xp6(11),t.Q6J("max",o.selectedRisco.percentualDisponivel)("placeholder",o.selectedRisco.percentualDisponivel+"% dispon\xedvel")("disabled",null==o.produto)("ngModel",o.percentual),t.xp6(2),t.Q6J("disabled",null==o.produto||null==o.produtoTributacaoRel||""==o.percentual.toString()||o.percentual>o.selectedRisco.percentualDisponivel),t.xp6(3),t.Q6J("ngIf",u.touched&&""==u.value),t.xp6(1),t.Q6J("ngIf",o.percentual>o.selectedRisco.percentualDisponivel),t.xp6(1),t.Q6J("ngIf",o.objeto.carteiraProdutoRel.length>0),t.xp6(2),t.Q6J("ngIf",o.erro||i.invalid),t.xp6(1),t.Q6J("disabled",i.invalid||o.loading||o.validatePercentualRisco()),t.xp6(1),t.Q6J("ngIf",o.loading)}},dependencies:[h.sg,h.O5,_._Y,_.Fj,_._,_.JJ,_.JL,_.On,_.F,v.BN,b.jx,C.hx,L.Lt,y.C,h.H9,C.Iq],styles:['.cdk-drop-list[_ngcontent-%COMP%]{position:relative;min-height:300px}.cdk-drop-list.cdkDrag[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;width:calc(100% - 10px);height:calc(100% - 10px);transform:translate(-50%,-50%);color:#00000073;font-size:18px;display:flex;align-items:center;justify-content:center;z-index:0}.cdk-drop-list.cdkDrag.empty[_ngcontent-%COMP%]:after{content:"Solte aqui para selecionar";border:1px #0000007a dashed}.cdk-drop-list.cdkDrag.empty[_ngcontent-%COMP%]:hover:after{border:1px #00000096 dashed;color:#00000096}.cdk-drag[_ngcontent-%COMP%]{position:relative;z-index:1;margin:0}.fade-in-right[_ngcontent-%COMP%]{animation:fade-in-right .5s forwards}.fade-out-left[_ngcontent-%COMP%]{animation:fade-out-left .5s forwards}.form-group[_ngcontent-%COMP%]{transition:.5s}@keyframes fade-in-right{0%{opacity:0;visibility:hidden;display:none;transform:translate(-100%)}20%{display:block}to{opacity:1;visibility:visible;transform:translate(0)}}@keyframes fade-out-left{0%{opacity:1;visibility:visible;transform:translate(0);display:block}20%{display:none}to{opacity:0;visibility:hidden;transform:translate(-100%)}}.data-view[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--grey-light) 50%,#ffffff 50%);border-radius:3px;background-size:200%;background-position:250%;display:flex;align-self:flex-start;position:relative;transition:.3s}.data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;padding:5px 10px;background-color:transparent;border-radius:3px}.data-view[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%], .data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{color:#fff}.data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{border-radius:0 3px 3px 0;border-color:#595c5f;border-left:none}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{color:#fff}.data-view.right[_ngcontent-%COMP%]{transition:.3s;background-position:153%}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{border:1px #8f8f8f solid;border-right:none;border-radius:3px 0 0 3px}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{color:#212529;transition:.3s color}.mat-option[_ngcontent-%COMP%]{height:auto!important;padding:9px 11px!important;line-height:1!important}.mat-option-text[_ngcontent-%COMP%]{font-size:14px!important}']}),s})()}}]);