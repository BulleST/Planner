<div class="modal__content">
    <div class="modal__header pb-2" style="padding: 0 25px;">
        <div>
            <a class="link text-dark" href="" (click)="voltar()">
                <fa-icon class="mr-1" [icon]="faChevronLeft"></fa-icon> Voltar
            </a>
            <h3 class="text-orange">Planner</h3>
        </div>
        <button class="btn btn-yellow" (click)="resetForm()">Limpar campos</button>
    </div>
    <div class="modal__body mt-0">
        <form #form="ngForm" (ngSubmit)="send(form)" class="needs-validation home editable">
            <div class="form-row mb-2">
                <div class="col-lg-8 col-md-8 col-sm-12">
                    <!-- Dados Cadastrais -->
                    <div class="form-row mb-1">
                        <div class="card card-body">
                            <div class="home__container-header mb-2">
                                <h6>Dados Cadastrais</h6>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-5 col-md-5 col-sm-12">
                                    <label for="nome">Nome Completo:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="nome"
                                           id="nome"
                                           class="form-control"
                                           #nome="ngModel"
                                           [(ngModel)]="planner.cliente.nome"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="nome.errors == null"
                                           triggers="mouseenter:mouseleave">
                                </div>
                                <div class="form-group col-lg-3 col-md-3 col-sm-12">
                                    <label for="perfilInvestidor">Perfil de Investidor:</label>
                                    <div class="form-floating">
                                        <select class="form-control"
                                                name="perfilInvestidor"
                                                id="perfilInvestidor"
                                                [class.form-control-loading]="loadingPerfilInvestidor"
                                                #_perfilInvestidor="ngModel"
                                                [(ngModel)]="planner.cliente.perfilInvestidor_Id"
                                                [ngbPopover]="campoObrigatorio"
                                                popoverClass="popover-danger"
                                                [disablePopover]="_perfilInvestidor.errors == null"
                                                triggers="mouseenter:mouseleave">
                                            <option [ngValue]="undefined">Selecione</option>
                                            <option [ngValue]="item.id" *ngFor="let item of perfilInvestidor">{{ item.descricao }} </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-12">
                                    <label for="estadoCivil">Estado Civil:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <select
                                            name="estadoCivil"
                                            id="estadoCivil"
                                            class="form-control"
                                            [class.form-control-loading]="loadingEstadoCivil"
                                            #_estadoCivil="ngModel"
                                            [(ngModel)]="planner.cliente.estadoCivil_Id"
                                            [ngbPopover]="campoObrigatorio"
                                            popoverClass="popover-danger"
                                            [disablePopover]="_estadoCivil.errors == null"
                                            triggers="mouseenter:mouseleave">
                                        <option [ngValue]="undefined">Selecione</option>
                                        <option [ngValue]="item.id" *ngFor="let item of estadoCivil">{{item.descricao}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-3 col-md-3 col-sm-6 col-6">
                                    <label for="cpf">CPF:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="cpf"
                                           id="cpf"
                                           class="form-control"
                                           #cpf="ngModel"
                                           [(ngModel)]="planner.cliente.cpf"
                                           mask="000.000.000-00"
                                           placeHolder="000.000.000-00"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="cpf.errors == null"
                                           triggers="mouseenter:mouseleave">
                                </div>
                                <div class="form-group col-lg-3 col-md-3 col-sm-6 col-6">
                                    <label for="rg">RG:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="rg"
                                           id="rg"
                                           class="form-control"
                                           #rg="ngModel"
                                           [(ngModel)]="planner.cliente.rg"
                                           mask="00.000.000-0"
                                           placeHolder="00.000.000-0"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="rg.errors == null"
                                           triggers="mouseenter:mouseleave">
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-6 col-6">
                                    <label for="dataNascimento">Data de Nascimento:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="date"
                                           name="dataNascimento"
                                           id="dataNascimento"
                                           class="form-control"
                                           #dataNascimento="ngModel"
                                           [(ngModel)]="planner.cliente.dataNascimento"
                                           (ngModelChange)="calculaIdade()"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="dataNascimento.errors == null"
                                           triggers="mouseenter:mouseleave">
                                </div>
                                <div class="form-group col-lg-2 col-md-2 col-sm-6 col-6">
                                    <label for="idade">Idade:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="idade"
                                           id="idade"
                                           class="form-control form-control-number"
                                           #idade="ngModel"
                                           [(ngModel)]="planner.cliente.idade"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="idade.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           mask="0*"
                                           suffix=" anos"
                                           (keyup.arrowup)="planner.cliente.idade = arrowUp(idade.value)"
                                           (keyup.arrowdown)="planner.cliente.idade = arrowDown(idade.value, true)">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                    <label for="email">E-mail:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="email"
                                           [email]="true"
                                           name="email"
                                           id="email"
                                           class="form-control"
                                           #email="ngModel"
                                           [(ngModel)]="planner.cliente.email"
                                           placeholder="example@gmail.com"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="email.errors == null"
                                           triggers="mouseenter:mouseleave">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-4 col-md-4 col-sm-6">
                                    <label for="peso">Peso:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="peso"
                                           id="peso"
                                           class="form-control form-control-number"
                                           #peso="ngModel"
                                           [(ngModel)]="planner.cliente.peso"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="peso.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           mask="separator.5"
                                           thousandSeparator="."
                                           decimalMarker=","
                                           suffix="kg"
                                           (keyup.arrowup)="planner.cliente.peso = arrowUp(peso.value)"
                                           (keyup.arrowdown)="planner.cliente.peso = arrowDown(peso.value, true)">
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-6">
                                    <label for="altura">Altura:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="altura"
                                           id="altura"
                                           class="form-control form-control-number"
                                           #altura="ngModel"
                                           [(ngModel)]="planner.cliente.altura"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="altura.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           mask="separator.5"
                                           thousandSeparator="."
                                           decimalMarker=","
                                           suffix="cm"
                                           (keyup.arrowup)="planner.cliente.altura = arrowUp(altura.value)"
                                           (keyup.arrowdown)="planner.cliente.altura = arrowDown(altura.value, true)">
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-6">
                                    <label for="imc">IMC:
                                        <!--<span class="text-danger">*</span>-->
                                    </label>
                                    <input type="text"
                                           name="imc"
                                           id="imc"
                                           class="form-control form-control-number"
                                           #imc="ngModel"
                                           [(ngModel)]="planner.cliente.imc"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="imc.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           mask="separator.5"
                                           thousandSeparator="."
                                           decimalMarker=","
                                           suffix="%"
                                           (keyup.arrowup)="planner.cliente.imc = arrowUp(imc.value)"
                                           (keyup.arrowdown)="planner.cliente.imc = arrowDown(imc.value, true)">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Cálculos -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Cálculos</h6>
                            </div>
                            <div class="form-row">
                                <table class="table table-editable table-responsive">
                                    <thead class="primary">
                                        <tr>
                                            <th></th>
                                            <th>Baixíssimo</th>
                                            <th>Baixo</th>
                                            <th>Moderado</th>
                                            <th>Arrojado</th>
                                            <th style="white-space: nowrap;">Super Arrojado</th>
                                            <th>Hedge</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="px-3 bg-light text-right"><small><b>Sugestão</b></small></td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Baixissimo"
                                                       name="sugestao_Baixissimo"
                                                       #sugestao_Baixissimo="ngModel"
                                                       [(ngModel)]="planner.sugestao_Baixissimo"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Baixo"
                                                       name="sugestao_Baixo"
                                                       #sugestao_Baixo="ngModel"
                                                       [(ngModel)]="planner.sugestao_Baixo"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Moderado"
                                                       name="sugestao_Moderado"
                                                       #sugestao_Moderado="ngModel"
                                                       [(ngModel)]="planner.sugestao_Moderado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Arrojado"
                                                       name="sugestao_Arrojado"
                                                       #sugestao_Arrojado="ngModel"
                                                       [(ngModel)]="planner.sugestao_Arrojado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_SuperArrojado"
                                                       name="sugestao_SuperArrojado"
                                                       #sugestao_SuperArrojado="ngModel"
                                                       [(ngModel)]="planner.sugestao_SuperArrojado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Hedge"
                                                       name="sugestao_Hedge"
                                                       #sugestao_Hedge="ngModel"
                                                       [(ngModel)]="planner.sugestao_Hedge"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Total"
                                                       name="sugestao_Total"
                                                       #sugestao_Total="ngModel"
                                                       [(ngModel)]="planner.sugestao_Total"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 bg-light text-right"><small><b>Plano</b></small></td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_Baixissimo"
                                                       name="plano_Baixissimo"
                                                       #plano_Baixissimo="ngModel"
                                                       [(ngModel)]="planner.plano_Baixissimo"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_Baixo"
                                                       name="plano_Baixo"
                                                       #plano_Baixo="ngModel"
                                                       [(ngModel)]="planner.plano_Baixo"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_Moderado"
                                                       name="plano_Moderado"
                                                       #plano_Moderado="ngModel"
                                                       [(ngModel)]="planner.plano_Moderado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_Arrojado"
                                                       name="plano_Arrojado"
                                                       #plano_Arrojado="ngModel"
                                                       [(ngModel)]="planner.plano_Arrojado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_SuperArrojado"
                                                       name="plano_SuperArrojado"
                                                       #plano_SuperArrojado="ngModel"
                                                       [(ngModel)]="planner.plano_SuperArrojado"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="plano_Hedge"
                                                       name="plano_Hedge"
                                                       #plano_Hedge="ngModel"
                                                       [(ngModel)]="planner.plano_Hedge"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="sugestao_Total"
                                                       name="sugestao_Total"
                                                       #sugestao_Total="ngModel"
                                                       [(ngModel)]="planner.sugestao_Total"
                                                       mask="separator"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       readonly>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Investimento -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Investimento</h6>
                                <a class="btn btn-primary" [routerLink]="['investimento']">Adicionar</a>
                            </div>
                            <div class="form-row">
                                <p-table [value]="planner.planejamentoInvestimento"
                                         class="table table-editable"
                                         emptyMessage="Nenhum registro">
                                    <ng-template pTemplate="header">
                                        <tr class="primary">
                                            <th class="text-right"></th>
                                            <th pResizableColumn style="white-space: nowrap;">Rentabilidade</th>
                                            <th pResizableColumn style="white-space: nowrap;">Tributação</th>
                                            <th pResizableColumn style="white-space: nowrap;">Rentab. Liquida</th>
                                            <th pResizableColumn style="white-space: nowrap;">Montante Atual</th>
                                            <th pResizableColumn style="white-space: nowrap;">Montante Sugerida</th>
                                            <th pResizableColumn style="white-space: nowrap;">Plano de Ação</th>
                                            <th class="td-actions"></th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-item>
                                        <tr>
                                            <td class=" px-3 bg-light text-right" style="white-space: nowrap;">
                                                <small>
                                                    <b>{{ item.investimentoTributacaoRel?.investimento?.descricao}}</b>
                                                </small>
                                            </td>
                                            <td class="">
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rentabilidade-{{item.id}}"
                                                       name="rentabilidade-{{item.id}}"
                                                       #rentabilidade="ngModel"
                                                       [(ngModel)]="item.rentabilidade"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [allowNegativeNumbers]="true"
                                                       (keyup.arrowup)="item.rentabilidade = arrowUp(rentabilidade.value)"
                                                       (keyup.arrowdown)="item.rentabilidade = arrowDown(rentabilidade.value, true)"
                                                       [ngbPopover]="setaUpDown"
                                                       triggers="mouseenter:mouseleave">
                                            </td>
                                            <td class="px-2" style="white-space: nowrap"> {{ item.investimentoTributacaoRel?.tributacao?.descricao }} </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.rentabilidadeLiquida | mask : 'separator' : ',' }} </td>
                                            <td class="">
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="montanteAtual-{{item.id}}"
                                                       name="montanteAtual-{{item.id}}"
                                                       #montanteAtual="ngModel"
                                                       [(ngModel)]="item.montanteAtual"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$"
                                                       (keyup.arrowup)="item.montanteAtual = arrowUp(montanteAtual.value)"
                                                       (keyup.arrowdown)="item.montanteAtual = arrowDown(montanteAtual.value, true)"
                                                       [ngbPopover]="setaUpDown"
                                                       triggers="mouseenter:mouseleave">
                                            </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.montanteSugerido | mask : 'separator' : ',' }} </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.planoSugerido | mask : 'separator' : ','}} </td>
                                            <td class="td-actions">
                                                <a class="btn btn-trash" title="Remover linha" (click)="removerInvestimento(item)">
                                                    <fa-icon [icon]="faTrash"></fa-icon>
                                                </a>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td></td>
                                            <td [attr.colspan]="6" class="py-2px-2 text-grey"> Nenhum registro </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </div>
                    </div>
                    <!-- Produto -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Produto</h6>
                                <div class="d-flex col-lg-4 col-md-5 col-sm-12 justify-content-end px-0">
                                    <p-dropdown
                                                class="form-control"
                                                id="carteirasSetup"
                                                name="carteirasSetup"
                                                #_carteirasSetup="ngModel"
                                                [class.form-control-loading]="loadingCarteiraSetup"
                                                [disabled]="loadingCarteiraSetup"
                                                [options]="carteirasSetup"
                                                [(ngModel)]="planner.carteiraSetup"
                                                optionLabel="nome"
                                                [filter]="true"
                                                filterBy="nome"
                                                [showClear]="true"
                                                placeholder="Selecione para adicionar"
                                                (ngModelChange)="carteiraSetupChange(_carteirasSetup)">
                                        <ng-template pTemplate="selectedItem">
                                            <div class="country-item country-item-value" *ngIf="planner.carteiraSetup">
                                                <p>{{planner.carteiraSetup.nome}}</p>
                                            </div>
                                        </ng-template>
                                        <ng-template let-p pTemplate="item">
                                            <div class="country-item">
                                                <div>
                                                    <p>{{p.nome}}</p>
                                                </div>
                                            </div>
                                        </ng-template>
                                    </p-dropdown>
                                    <button type="button" class="btn btn-primary ml-1 d-flex align-items-center" (click)="adicionarProduto()" *ngIf="planner.carteiraSetup && planner.planejamentoInvestimento.length > 0">Adicionar</button>
                                </div>
                            </div>
                            <div class="form-row">
                                <p class="text-danger px-2" *ngIf="planner.planejamentoInvestimento.length == 0">* Insira um investimento para adicionar um produto</p>
                                <p-table
                                         [value]="planner.planejamentoProduto"
                                         [responsive]="true"
                                         responsiveLayout="scroll"
                                         class="table table-editable">
                                    <ng-template pTemplate="header" let-columns>
                                        <tr class="primary">
                                            <th class="text-right"></th>
                                            <th style="white-space: nowrap;">Rentabilidade</th>
                                            <th style="white-space: nowrap;">Tributação</th>
                                            <th style="white-space: nowrap;">Rentab. Liquida</th>
                                            <th style="white-space: nowrap;">Montante Atual</th>
                                            <th style="white-space: nowrap;">Montante Sugerida</th>
                                            <th style="white-space: nowrap;">Plano de Ação</th>
                                            <th class="td-actions"></th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-item>
                                        <tr>
                                            <td class="px-3 bg-light text-right" 
                                            (mouseenter)="produtoHover = item.produtoTributacaoRel?.produto" 
                                            (mouseleave)="produtoHover = undefined">
                                                <small><b>{{ item.produtoTributacaoRel?.produto?.descricao }}</b></small>
                                                <div class="produto-hover" *ngIf="produtoHover == item" >
                                                    oi
                                                </div>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rentabilidade-{{item.id}}"
                                                       name="rentabilidade-{{item.id}}"
                                                       #rentabilidade="ngModel"
                                                       [(ngModel)]="item.rentabilidade"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [allowNegativeNumbers]="true"
                                                       (keyup.arrowup)="item.rentabilidade = arrowUp(rentabilidade.value)"
                                                       (keyup.arrowdown)="item.rentabilidade = arrowDown(rentabilidade.value, true)"
                                                       [ngbPopover]="setaUpDown"
                                                       triggers="mouseenter:mouseleave">
                                            </td>
                                            <td class="px-2" style="white-space: nowrap"> {{ item.produtoTributacaoRel?.tributacao?.descricao }} </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.rentabilidadeLiquida | mask : 'separator' : ',' }} </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="montanteAtual-{{item.id}}"
                                                       name="montanteAtual-{{item.id}}"
                                                       #montanteAtual="ngModel"
                                                       [(ngModel)]="item.montanteAtual"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$"
                                                       (keyup.arrowup)="item.montanteAtual = arrowUp(montanteAtual.value)"
                                                       (keyup.arrowdown)="item.montanteAtual = arrowDown(montanteAtual.value, true)"
                                                       [ngbPopover]="setaUpDown"
                                                       triggers="mouseenter:mouseleave">
                                            </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.montanteSugerido | mask : 'separator' : ',' }} </td>
                                            <td class="px-2" style="white-space: nowrap"> R$ {{ item.planoSugerido | mask : 'separator' : ','}} </td>
                                            <td class="td-actions">
                                                <a class="btn btn-trash" title="Remover linha" (click)="removerProduto(item)">
                                                    <fa-icon [icon]="faTrash"></fa-icon>
                                                </a>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td></td>
                                            <td [attr.colspan]="6" class="p-2 text-grey"> Nenhum registro </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </div>
                    </div>
                    <!-- Solução Inicial -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Solução Inicial</h6>
                            </div>
                            <div class="form-row">
                                <table class="table table-editable table-responsive">
                                    <thead>
                                        <tr class="primary">
                                            <th colspan="6" class="text-center p-2">
                                                <h6>Agregando Valor</h6>
                                            </th>
                                        </tr>
                                        <tr class="">
                                            <th colspan="2" class="text-right primary">Montante Total</th>
                                            <th style="background-color: var(--primary-light);color: #fff">0</th>
                                            <th class="primary">Exposição a Risco</th>
                                            <th colspan="2" style="background-color: var(--primary-light);color: #fff">0</th>
                                        </tr>
                                        <tr class="subheader" class="primary">
                                            <th style="white-space: nowrap;" class="text-right">Carteira</th>
                                            <th style="white-space: nowrap;">Rentabilidade Atual <small>(ano)</small></th>
                                            <th style="white-space: nowrap;">Retorno anual <small>(R$)</small></th>
                                            <th style="white-space: nowrap;">Retorno mensal <small>(R$)</small></th>
                                            <th style="white-space: nowrap;">Patrimônio Máximo <small>(R$)</small></th>
                                            <th style="white-space: nowrap;">Tempo <small>(anos)</small></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of carteira">
                                            <td class="px-3 bg-light text-right" style="white-space: nowrap;">
                                                <small>{{item.tipo}}</small>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rentabilidadeAtual-{{item.id}}"
                                                       name="rentabilidadeAtual-{{item.id}}"
                                                       #rentabilidadeAtual="ngModel"
                                                       [(ngModel)]="item.rentabilidadeAtual">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="retornoAnual-{{item.id}}"
                                                       name="retornoAnual-{{item.id}}"
                                                       #retornoAnual="ngModel"
                                                       [(ngModel)]="item.retornoAnual">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="retornoMensal-{{item.id}}"
                                                       name="retornoMensal-{{item.id}}"
                                                       #retornoMensal="ngModel"
                                                       [(ngModel)]="item.retornoMensal">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="patrimonioMaximo-{{item.id}}"
                                                       name="patrimonioMaximo-{{item.id}}"
                                                       #patrimonioMaximo="ngModel"
                                                       [(ngModel)]="item.patrimonioMaximo">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="tempo-{{item.id}}"
                                                       name="tempo-{{item.id}}"
                                                       #tempo="ngModel"
                                                       [(ngModel)]="item.tempo">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="py-2 bg-light text-center font-weight-bold" style="white-space: nowrap;">Melhora de Desempenho</td>
                                            <td class="py-2">
                                                <!-- <fa-icon [icon]="faArrowRight"></fa-icon> -->
                                            </td>
                                            <td class="py-2">0</td>
                                            <td class="py-2">+120</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Patrimônio por Idade -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Patrimônio por Idade</h6>
                            </div>
                            <div class="form-row chart-container" id="chart-patrimonio-idade">
                                <p-chart #chartPatrimonioIdade [data]="chartPatrimonioIdadeData" [options]="chartPatrimonioIdadeOptions" [width]="chartSize['chart-patrimonio-idade']['width']" [height]="chartSize['chart-patrimonio-idade']['height']"></p-chart>
                            </div>
                        </div>
                    </div>
                    <!-- Capital Segurado -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Capital Segurado</h6>
                            </div>
                            <div class="form-row chart-container" id="chart-capital-segurado">
                                <p-chart #chartCapitalSegurado [data]="chartCapitalSeguradoData" [options]="chartCapitalSeguradoOptions" [width]="chartSize['chart-capital-segurado']['width']" [height]="chartSize['chart-patrimonio-idade']['height']"></p-chart>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-12">
                    <!-- Capacidade de Risco -->
                    <div class="form-row mb-1">
                        <div class="card card-body">
                            <div class="home__container-header mb-4">
                                <h6>Capacidade de Risco</h6>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-12 px-0">
                                <div class="form-container">
                                    <div class="form-container-title font-weight-bold">Reserva de Emergência</div>
                                    <div class="form-container-body">
                                        <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-1">
                                            <label for="rE_Sugerido"> Sugerida:</label>
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="rE_Sugerido"
                                                   name="rE_Sugerido"
                                                   #rE_Sugerido="ngModel"
                                                   [(ngModel)]="planner.rE_Sugerido"
                                                   mask="separator.5"
                                                   thousandSeparator="."
                                                   decimalMarker=","
                                                   [allowNegativeNumbers]="false"
                                                   placeholder="R$ 00,00"
                                                   prefix="R$ "
                                                   (keyup.arrowup)="planner.rE_Sugerido = arrowUp(rE_Sugerido.value)"
                                                   (keyup.arrowdown)="planner.rE_Sugerido = arrowDown(rE_Sugerido.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="rE_Sugerido.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </div>
                                        <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-0">
                                            <label for="rE_Planejado"> Planejada:</label>
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="rE_Planejado"
                                                   name="rE_Planejado"
                                                   #rE_Planejado="ngModel"
                                                   [(ngModel)]="planner.rE_Planejado"
                                                   mask="separator.5"
                                                   thousandSeparator="."
                                                   decimalMarker=","
                                                   [allowNegativeNumbers]="false"
                                                   placeholder="R$ 00,00"
                                                   prefix="R$ "
                                                   (keyup.arrowup)="planner.rE_Planejado = arrowUp(rE_Planejado.value)"
                                                   (keyup.arrowdown)="planner.rE_Planejado = arrowDown(rE_Planejado.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="rE_Planejado.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-12 px-0">
                                <div class="form-container mb-0">
                                    <div class="form-container-title font-weight-bold">Risco</div>
                                    <div class="form-container-body">
                                        <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-1">
                                            <label for="riscoAssumido"> Assumido:</label>
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="riscoAssumido"
                                                   name="riscoAssumido"
                                                   #riscoAssumido="ngModel"
                                                   [(ngModel)]="planner.riscoAssumido"
                                                   mask="separator.5"
                                                   thousandSeparator="."
                                                   decimalMarker=","
                                                   [allowNegativeNumbers]="false"
                                                   placeholder="R$ 00,00"
                                                   prefix="R$ "
                                                   (keyup.arrowup)="planner.riscoAssumido = arrowUp(riscoAssumido.value)"
                                                   (keyup.arrowdown)="planner.riscoAssumido = arrowDown(riscoAssumido.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="riscoAssumido.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </div>
                                        <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-0">
                                            <label for="riscoTolerado"> Tolerado:</label>
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="riscoTolerado"
                                                   name="riscoTolerado"
                                                   #riscoTolerado="ngModel"
                                                   [(ngModel)]="planner.riscoTolerado"
                                                   mask="separator.5"
                                                   thousandSeparator="."
                                                   decimalMarker=","
                                                   [allowNegativeNumbers]="false"
                                                   placeholder="R$ 00,00"
                                                   prefix="R$ "
                                                   (keyup.arrowup)="planner.riscoTolerado = arrowUp(riscoTolerado.value)"
                                                   (keyup.arrowdown)="planner.riscoTolerado = arrowDown(riscoTolerado.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="riscoTolerado.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Aposentadoria -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <table class="table table-editable table-responsive w-100 d-md-table d-sm-table">
                                <thead class="primary">
                                    <tr>
                                        <th></th>
                                        <th>Aposentadoria</th>
                                        <th>Variação</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Idade</b></small>
                                        </td>
                                        <td>
                                            <div class="form-floating">
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="idadeAposentadoria"
                                                       name="idadeAposentadoria"
                                                       #idadeAposentadoria="ngModel"
                                                       [(ngModel)]="planner.cliente.idadeAposentadoria"
                                                       mask="0*"
                                                       suffix=" anos"
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="0"
                                                       (keyup.arrowup)="planner.cliente.idadeAposentadoria = arrowUp(idadeAposentadoria.value)"
                                                       (keyup.arrowdown)="planner.cliente.idadeAposentadoria = arrowDown(idadeAposentadoria.value)"
                                                       [ngbPopover]="campoObrigatorio"
                                                       popoverClass="popover-danger"
                                                       [disablePopover]="idadeAposentadoria.errors == null"
                                                       triggers="mouseenter:mouseleave">
                                            </div>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" id="baixissimo" name="baixissimo" #baixissimo>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Renda Mensal</b></small>
                                        </td>
                                        <td>
                                            <div class="form-floating">
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rendaMensalAposentadoria"
                                                       name="rendaMensalAposentadoria"
                                                       #rendaMensalAposentadoria="ngModel"
                                                       [(ngModel)]="planner.cliente.rendaMensalAposentadoria"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [prefix]="rendaMensalAposentadoria.value != '' ? 'R$ ' : ''"
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="R$ 00,00"
                                                       (keyup.arrowup)="planner.cliente.rendaMensalAposentadoria = arrowUp(rendaMensalAposentadoria.value)"
                                                       (keyup.arrowdown)="planner.cliente.rendaMensalAposentadoria = arrowDown(rendaMensalAposentadoria.value)"
                                                       [ngbPopover]="campoObrigatorio"
                                                       popoverClass="popover-danger"
                                                       [disablePopover]="rendaMensalAposentadoria.errors == null"
                                                       triggers="mouseenter:mouseleave">
                                            </div>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" id="baixissimo" name="baixissimo" #baixissimo>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Rentabilidade</b></small>
                                        </td>
                                        <td>
                                            <div class="form-floating">
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rentabilidadeAposentadoria"
                                                       name="rentabilidadeAposentadoria"
                                                       #rentabilidadeAposentadoria="ngModel"
                                                       [(ngModel)]="planner.cliente.rentabilidadeAposentadoria"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="true"
                                                       placeholder="00,00%"
                                                       suffix="%"
                                                       (keyup.arrowup)="planner.cliente.rentabilidadeAposentadoria = arrowUp(rentabilidadeAposentadoria.value)"
                                                       (keyup.arrowdown)="planner.cliente.rentabilidadeAposentadoria = arrowDown(rentabilidadeAposentadoria.value)"
                                                       [ngbPopover]="campoObrigatorio"
                                                       popoverClass="popover-danger"
                                                       [disablePopover]="rentabilidadeAposentadoria.errors == null"
                                                       triggers="mouseenter:mouseleave">
                                            </div>
                                        </td>
                                        <td>
                                            <input type="text"
                                                   class="form-control"
                                                   id="baixissimo"
                                                   name="baixissimo"
                                                   readonly>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Fluxos Pontuais -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <table class="table table-editable table-responsive w-100 d-table">
                                <thead class="primary">
                                    <tr>
                                        <th colspan="3" class="pl-4">
                                            <p class="text-center d-flex align-items-center"> Fluxos Pontuais <a class="btn p-0 ml-auto text-white" (click)="adicionarFLuxoPontual()" title="Adicionar">
                                                    <fa-icon [icon]="faPlus"></fa-icon>
                                                </a>
                                            </p>
                                        </th>
                                    </tr>
                                    <tr class="subheader">
                                        <th class="pl-4">Idade</th>
                                        <th>Valor</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of planner.planejamentoFluxosPontuais">
                                        <td class="pl-4">
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="idade-{{item.id}}"
                                                   name="idade-{{item.id}}"
                                                   #idade="ngModel"
                                                   [(ngModel)]="item.idade"
                                                   mask="0*"
                                                   suffix=" anos"
                                                   (keyup.arrowup)="item.idade = arrowUp(idade.value)"
                                                   (keyup.arrowdown)="item.idade = arrowDown(idade.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="idade.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </td>
                                        <td>
                                            <input type="text"
                                                   class="form-control form-control-number"
                                                   id="valor{{item.id}}"
                                                   name="valor{{item.id}}"
                                                   #valor="ngModel"
                                                   [(ngModel)]="item.valor"
                                                   mask="separator.5"
                                                   thousandSeparator="."
                                                   decimalMarker=","
                                                   placeholder="R$ 00,00"
                                                   prefix="R$ "
                                                   (keyup.arrowup)="item.valor = arrowUp(valor.value)"
                                                   (keyup.arrowdown)="item.valor = arrowDown(valor.value)"
                                                   [ngbPopover]="campoObrigatorio"
                                                   popoverClass="popover-danger"
                                                   [disablePopover]="valor.errors == null"
                                                   triggers="mouseenter:mouseleave">
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-trash d-inline" (click)="removerFluxoPontual(item)" title="Remover linha">
                                                <fa-icon [icon]="faTrash"></fa-icon>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr *ngIf="planner.planejamentoFluxosPontuais.length == 0">
                                        <td class="py-2 pl-4 text-grey" colspan="3">Nenhum registro</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Principais objetivos -->
                    <div class="form-row mb-1">
                        <div class="home__container">
                            <table class="table table-editable table-responsive w-100 d-md-table d-sm-table">
                                <thead class="primary">
                                    <tr>
                                        <th colspan="3" class="pl-4 pr-2">
                                            <p class="text-center d-flex align-items-center"> Principais objetivos <a class="btn p-0 ml-auto text-white" title="Adicionar objetivo" (click)="adicionarObjetivo()" title="Adicionar">
                                                    <fa-icon [icon]="faPlus"></fa-icon>
                                                </a>
                                            </p>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of planner.principaisObjetivos">
                                        <td colspan="2">
                                            <textarea
                                                      class="form-control"
                                                      id="descricao"
                                                      name="descricao"
                                                      #descricao="ngModel"
                                                      [(ngModel)]="item.descricao"
                                                      style="resize: vertical;"
                                                      rows="1"></textarea>
                                        </td>
                                        <td class="text-center" style="width: 20px;">
                                            <button class="btn btn-trash d-inline" (click)="removerObjetivo(item)" title="Remover linha">
                                                <fa-icon [icon]="faTrash"></fa-icon>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr *ngIf="planner.principaisObjetivos.length == 0">
                                        <td colspan="3" class="py-2 pl-4 text-grey">Nenhum registro</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-footer-submit-fixed">
                <div *ngIf="erro || form.invalid" class="m-0">
                    <p class="text-red" *ngFor="let err of erro">{{err}}</p>
                    <p *ngIf="erro.length == 0" class="text-red">Preencha todos os campos corretamente para salvar</p>
                </div>
                <button class="btn btn-primary mr-0 ml-auto" [disabled]="form.invalid || loading">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span> Salvar </button>
            </div>
        </form>
        <ng-template #campoObrigatorio>
            <div class="py-3 px-4"> Este campo é obrigatório </div>
        </ng-template>
        <ng-template #setaUpDown>
            <div class="py-3 px-4"> Acione a seta para cima ou para baixo no teclado para mudar o valor </div>
        </ng-template>
    </div>
</div>
<router-outlet></router-outlet>