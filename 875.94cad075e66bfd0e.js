"use strict";(self.webpackChunkplanner=self.webpackChunkplanner||[]).push([[875],{4458:(W,A,r)=>{r.d(A,{G:()=>Z});var v=r(801),t=r(9808),C=r(6025),I=r(9205),y=r(9243),j=r(878),l=r(4650),i=r(202),U=r(7549),S=r(7185),M=r(3389),D=r(3868);let Z=(()=>{class f{constructor(u,p,s,m,b){if(this.activatedRoute=u,this.modal=p,this.setupService=s,this.toastr=m,this.crypto=b,this.faTimes=v.NBC,this.faWallet=v.X5K,this.faChevronLeft=v.A35,this.modalOpen=!1,this.objeto=new C.Wj,this.erro=[],this.loading=!1,this.url="",this.subscription=[],this.clearData=!1,this.routerBack=["../"],this.routeBackOptions={relativeTo:this.activatedRoute},this.url=this.activatedRoute.snapshot.pathFromRoot.map(T=>T.routeConfig?.path).join("/"),this.url.includes("empresas/editar")){var P=u.parent?.parent?.params.subscribe(T=>{T.empresa_id?this.objeto.empresa_Id=this.crypto.decrypt(T.empresa_id):this.voltar()});P&&this.subscription.push(P)}this.objeto.carteiraProdutoRel.push({id:0,carteiraSetup_Id:0,percentual:0,produto_Id:61,produto:{id:61,descricao:"Conta Corrente",tipoRisco_Id:1,tipoRisco:{id:1,nome:"Baix\xedssimo"},tipoAtivo_Id:1,tipoLiquidez_Id:0}})}voltar(){this.modal.voltar(this.routerBack,this.routeBackOptions)}ngOnDestroy(){this.subscription.forEach(u=>u.unsubscribe())}resetForm(){var u=this.objeto.carteiraProdutoRel.find(p=>61==p.produto_Id);this.objeto=new C.Wj,this.objeto.carteiraProdutoRel=[u],this.setupService.setObject(this.objeto),this.clearData=!0}send(u){this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")?(this.setupService.add_To_Empresa_List(this.objeto)&&(this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.voltar()),this.loading=!1):(this.url.includes("empresas/editar"),(0,t.n)(this.setupService.create(this.objeto)).then(p=>{(0,t.n)(this.setupService.getList())}).catch(p=>{this.erro.push((0,j.b)(p))}).finally(()=>this.loading=!1))}}return f.\u0275fac=function(u){return new(u||f)(l.Y36(i.gz),l.Y36(U.Q),l.Y36(I.A),l.Y36(S._W),l.Y36(y.w))},f.\u0275cmp=l.Xpm({type:f,selectors:[["app-create"]],decls:13,vars:5,consts:[[1,"modal__content"],[1,"modal__header","pb-2",2,"padding","0 25px"],[1,"link","text-dark",3,"click"],[1,"mr-1",3,"icon"],[1,"text-orange","mt-2"],[1,"btn","btn-yellow",3,"click"],[1,"modal__body","mt-0"],[3,"objeto","loading","erro","clearData","sendData"]],template:function(u,p){1&u&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),l.NdJ("click",function(){return p.voltar()}),l._UZ(4,"fa-icon",3),l._uU(5," Voltar "),l.qZA(),l.TgZ(6,"h3",4),l._uU(7,"Adicionar carteira setup"),l.qZA()(),l.TgZ(8,"button",5),l.NdJ("click",function(){return p.resetForm()}),l._uU(9,"Limpar campos"),l.qZA()(),l.TgZ(10,"div",6)(11,"app-form-carteira-setup",7),l.NdJ("sendData",function(m){return p.send(m)}),l.qZA()()(),l._UZ(12,"router-outlet")),2&u&&(l.xp6(4),l.Q6J("icon",p.faChevronLeft),l.xp6(7),l.Q6J("objeto",p.objeto)("loading",p.loading)("erro",p.erro)("clearData",p.clearData))},dependencies:[i.lC,M.U,D.BN]}),f})()},8811:(W,A,r)=>{r.d(A,{T:()=>M});var v=r(5861),t=r(801),C=r(9808),I=r(6025),y=r(9205),j=r(9243),l=r(4650),i=r(202),U=r(7549),S=r(7119);let M=(()=>{class D{constructor(f,g,u,p){var s=this;this.activatedRoute=f,this.modal=g,this.setupService=u,this.crypto=p,this.faTimes=t.NBC,this.modalOpen=!1,this.erro=[],this.loading=!1,this.url="",this.objeto=new I.Wj,this.subscription=[],this.routerBack=["../../"],this.routeBackOptions={relativeTo:this.activatedRoute};var m=this.modal.getOpen().subscribe(P=>this.modalOpen=P);this.subscription.push(m),this.url=this.activatedRoute.snapshot.pathFromRoot.map(P=>P.routeConfig?.path).join("/");var b=f.params.subscribe(function(){var P=(0,v.Z)(function*(T){T.setup_id?(s.objeto.id=s.crypto.decrypt(T.setup_id),s.objeto=yield(0,C.n)(s.setupService.get(s.objeto.id))):s.voltar()});return function(T){return P.apply(this,arguments)}}());this.subscription.push(b),setTimeout(()=>{this.modal.setOpen(!0)},200)}ngOnDestroy(){this.subscription.forEach(f=>f.unsubscribe())}voltar(){this.modal.voltar(this.routerBack,this.routeBackOptions)}}return D.\u0275fac=function(f){return new(f||D)(l.Y36(i.gz),l.Y36(U.Q),l.Y36(y.A),l.Y36(j.w))},D.\u0275cmp=l.Xpm({type:D,selectors:[["app-deactivated"]],decls:5,vars:4,consts:[[1,"modal"],[1,"modal__bg",3,"click"],[1,"modal__inner",2,"max-width","600px"],[1,"modal__content"],[3,"objeto","service"]],template:function(f,g){1&f&&(l.TgZ(0,"div",0)(1,"div",1),l.NdJ("click",function(){return g.voltar()}),l.qZA(),l.TgZ(2,"div",2)(3,"div",3),l._UZ(4,"app-shared-deactivated",4),l.qZA()()()),2&f&&(l.ekj("active",g.modalOpen),l.xp6(4),l.Q6J("objeto",g.objeto)("service",g.setupService))},dependencies:[S.T]}),D})()},4115:(W,A,r)=>{r.d(A,{T:()=>g});var v=r(801),t=r(9808),C=r(6025),I=r(8913),y=r(9205),j=r(9243),l=r(878),i=r(4650),U=r(202),S=r(7549),M=r(6895);function D(u,p){1&u&&(i._UZ(0,"p",15),i.ALo(1,"json")),2&u&&i.Q6J("innerHTML",i.lcZ(1,1,p.$implicit),i.oJD)}function Z(u,p){if(1&u&&(i.TgZ(0,"div",13),i.YNc(1,D,2,3,"p",14),i.qZA()),2&u){const s=i.oxw();i.xp6(1),i.Q6J("ngForOf",s.erro)}}function f(u,p){1&u&&i._UZ(0,"span",16)}let g=(()=>{class u{constructor(s,m,b,P,T){this.activatedRoute=s,this.modal=m,this.empresaService=b,this.setupService=P,this.crypto=T,this.faTimes=v.NBC,this.modalOpen=!1,this.erro=[],this.loading=!1,this.url="",this.objeto=new C.Wj,this.subscription=[],this.routerBack=["../../"],this.routeBackOptions={relativeTo:this.activatedRoute};var L=this.modal.getOpen().subscribe(x=>this.modalOpen=x);this.subscription.push(L),this.url=this.activatedRoute.snapshot.pathFromRoot.map(x=>x.routeConfig?.path).join("/");var E=s.params.subscribe(x=>{x.setup_id?this.objeto.id=this.crypto.decrypt(x.setup_id):this.voltar()});this.subscription.push(E),(this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo)&&(this.objeto=this.empresaService.object.carteiraSetup.find(x=>x.id==this.objeto.id)),setTimeout(()=>{this.modal.setOpen(!0)},200)}ngOnDestroy(){this.subscription.forEach(s=>s.unsubscribe())}voltar(){this.modal.voltar(this.routerBack,this.routeBackOptions)}send(){this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?(this.setupService.delete_To_Empresa_List(this.objeto.id)&&this.voltar(),this.loading=!1):(0,t.n)(this.setupService.delete(this.objeto.id)).then(s=>{(0,t.n)(this.setupService.getList()),this.voltar(),this.setupService.setObject(new C.Wj)}).catch(s=>this.erro.push((0,l.b)(s))).finally(()=>this.loading=!1)}}return u.\u0275fac=function(s){return new(s||u)(i.Y36(U.gz),i.Y36(S.Q),i.Y36(I.P),i.Y36(y.A),i.Y36(j.w))},u.\u0275cmp=i.Xpm({type:u,selectors:[["app-delete"]],decls:20,vars:4,consts:[[1,"modal"],[1,"modal__bg",3,"click"],[1,"modal__inner",2,"max-width","600px"],[1,"modal__content"],[1,"modal__header","pb-2"],[1,"text-orange"],[1,"modal__header-close","btn-close",3,"click"],[1,"modal__body","mt-0"],[1,"mt-2"],[1,"text-info"],["class","m-0  mt-1",4,"ngIf"],[1,"btn","btn-grey","ml-auto","d-flex","mt-2",3,"click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"m-0","mt-1"],["class","text-red",3,"innerHTML",4,"ngFor","ngForOf"],[1,"text-red",3,"innerHTML"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(s,m){1&s&&(i.TgZ(0,"div",0)(1,"div",1),i.NdJ("click",function(){return m.voltar()}),i.qZA(),i.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),i._uU(6,"Excluir registro"),i.qZA(),i.TgZ(7,"a",6),i.NdJ("click",function(){return m.voltar()}),i._UZ(8,"span")(9,"span"),i.qZA()(),i.TgZ(10,"div",7)(11,"p",8),i._uU(12,"Tem certeza que deseja excluir esse registro? Ele n\xe3o poder\xe1 ser recuperado."),i.qZA(),i.TgZ(13,"p",9),i._uU(14,"Obs.: Se esse setup estiver relacionado a um planner, n\xe3o poder\xe1 ser exclu\xeddo."),i.qZA(),i.YNc(15,Z,2,1,"div",10),i.TgZ(16,"button",11),i.NdJ("click",function(){return m.send()}),i.YNc(17,f,1,0,"span",12),i.TgZ(18,"span"),i._uU(19,"Excluir"),i.qZA()()()()()()),2&s&&(i.ekj("active",m.modalOpen),i.xp6(15),i.Q6J("ngIf",m.erro),i.xp6(2),i.Q6J("ngIf",m.loading))},dependencies:[M.sg,M.O5,M.Ts]}),u})()},5623:(W,A,r)=>{r.d(A,{F:()=>f});var v=r(801),t=r(9808),C=r(6025),I=r(8913),y=r(9205),j=r(9243),l=r(878),i=r(4650),U=r(202),S=r(7185),M=r(7549),D=r(3389),Z=r(3868);let f=(()=>{class g{constructor(p,s,m,b,P,T){this.activatedRoute=p,this.toastr=s,this.modal=m,this.crypto=b,this.setupService=P,this.empresaService=T,this.faTimes=v.NBC,this.faChevronLeft=v.A35,this.objeto=new C.Wj,this.erro=[],this.loading=!1,this.loadingProduto=!1,this.url="",this.subscription=[],this.routerBack=["../../"],this.clearData=!1,this.routeBackOptions={relativeTo:this.activatedRoute},this.url=this.activatedRoute.snapshot.pathFromRoot.map(E=>E.routeConfig?.path).join("/");var L=p.params.subscribe(E=>{E.setup_id?this.objeto.id=this.crypto.decrypt(E.setup_id):this.voltar()});this.subscription.push(L),this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?this.objeto=this.empresaService.object.carteiraSetup.find(E=>E.id==this.objeto.id):(0,t.n)(this.setupService.get(this.objeto.id)).then(E=>{this.objeto=E}).catch(E=>{this.voltar()}).finally(()=>this.loading=!1)}ngOnDestroy(){this.subscription.forEach(p=>p.unsubscribe())}voltar(){this.modal.voltar(this.routerBack,this.routeBackOptions)}resetForm(){var p=this.objeto.carteiraProdutoRel.find(s=>61==s.produto_Id);this.objeto=new C.Wj,this.objeto.carteiraProdutoRel=[p],this.setupService.setObject(this.objeto),this.clearData=!0}send(p){this.loading=!0,this.erro=[],this.url.includes("empresas/cadastrar")||this.objeto.registroNaoSalvo?(this.setupService.edit_To_Empresa_List(this.objeto)&&(this.toastr.success("Opera\xe7\xe3o conclu\xedda"),this.voltar()),this.loading=!1):(this.url.includes("empresas/editar"),(0,t.n)(this.setupService.edit(this.objeto)).then(s=>{(0,t.n)(this.setupService.getList())}).catch(s=>{this.erro.push((0,l.b)(s))}).finally(()=>this.loading=!1))}}return g.\u0275fac=function(p){return new(p||g)(i.Y36(U.gz),i.Y36(S._W),i.Y36(M.Q),i.Y36(j.w),i.Y36(y.A),i.Y36(I.P))},g.\u0275cmp=i.Xpm({type:g,selectors:[["app-edit"]],decls:13,vars:5,consts:[[1,"modal__content"],[1,"modal__header","pb-2",2,"padding","0 25px"],[1,"link","text-dark",3,"click"],[1,"mr-1",3,"icon"],[1,"text-orange","mt-2"],[1,"btn","btn-yellow",3,"click"],[1,"modal__body","mt-0"],[3,"objeto","loading","erro","clearData","sendData"]],template:function(p,s){1&p&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),i.NdJ("click",function(){return s.voltar()}),i._UZ(4,"fa-icon",3),i._uU(5," Voltar "),i.qZA(),i.TgZ(6,"h3",4),i._uU(7,"Editar carteira setup"),i.qZA()(),i.TgZ(8,"button",5),i.NdJ("click",function(){return s.resetForm()}),i._uU(9,"Limpar campos"),i.qZA()(),i.TgZ(10,"div",6)(11,"app-form-carteira-setup",7),i.NdJ("sendData",function(b){return s.send(b)}),i.qZA()()(),i._UZ(12,"router-outlet")),2&p&&(i.xp6(4),i.Q6J("icon",s.faChevronLeft),i.xp6(7),i.Q6J("objeto",s.objeto)("loading",s.loading)("erro",s.erro)("clearData",s.clearData))},dependencies:[U.lC,D.U,Z.BN]}),g})()},3389:(W,A,r)=>{r.d(A,{U:()=>_t});var v=r(5861),t=r(4650),C=r(801),I=r(6025),y=r(8913),j=r(9205),l=r(8259),i=r(1956),S=[{field:"id",header:"Id",filterType:i.vA.text,filterDisplay:i.w2.menu,maskType:i.O.undefined},{field:"tipoRisco.nome",header:"Tipo de Risco",filterType:i.vA.text,filterDisplay:i.w2.menu,maskType:i.O.undefined},{field:"percentual",header:"Percentual",filterType:i.vA.numeric,filterDisplay:i.w2.menu,maskType:i.O.percentage,decimal:"1.2"}],M=r(316),D=r(9535),Z=r(9885),f=r(9808),g=r(4551),u=r(7185),p=r(202),s=r(6895),m=r(433),b=r(3868),P=r(805),T=r(279),L=r(2210),E=r(9364),x=r(7897);const J=["chartProdutos"],K=["_percentual"],Y=["tipoRisco"];function k(a,_){1&a&&(t.TgZ(0,"p",40),t._uU(1,"Esse campo \xe9 obrigat\xf3rio"),t.qZA())}function Q(a,_){1&a&&(t.TgZ(0,"span"),t._uU(1,"Remova os espa\xe7os antes e depois do texto."),t.qZA())}function V(a,_){if(1&a&&(t.TgZ(0,"p",10),t.YNc(1,Q,2,0,"span",13),t.qZA()),2&a){t.oxw(2);const e=t.MAs(14);t.xp6(1),t.Q6J("ngIf","^\\S(.*\\S)?$"==e.errors.pattern.requiredPattern)}}function G(a,_){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,k,2,0,"p",39),t.YNc(2,V,2,1,"p",25),t.qZA()),2&a){t.oxw();const e=t.MAs(14);t.xp6(1),t.Q6J("ngIf",e.errors.required),t.xp6(1),t.Q6J("ngIf",e.errors.pattern)}}function q(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"div",41)(1,"input",42,43),t.NdJ("ngModelChange",function(){t.CHM(e);const n=t.MAs(2),c=t.oxw();return t.KtG(c.riscoChange(n))})("ngModelChange",function(n){t.CHM(e);const c=t.oxw();return t.KtG(c.selectedRisco=n)}),t.qZA(),t.TgZ(3,"label",44),t._uU(4),t.qZA()()}if(2&a){const e=_.$implicit,o=t.oxw();t.xp6(1),t.MGl("id","tipoRisco-",e.id,""),t.Q6J("ngModel",o.selectedRisco)("value",e)("checked",e.id==o.selectedRisco.id),t.xp6(2),t.MGl("for","tipoRisco-",e.id,""),t.xp6(1),t.Oqu(e.nome)}}function z(a,_){if(1&a&&(t.TgZ(0,"span",48),t._uU(1," Inativo "),t.qZA()),2&a){t.oxw();const e=t.MAs(5);t.Q6J("ngbPopover",e)}}function H(a,_){if(1&a&&(t.TgZ(0,"div",49),t._uU(1),t.ALo(2,"date"),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij("Desativado em ",t.Dn7(2,1,e.dataDesativado,"dd/MM/yyyy","UTC")," ")}}function $(a,_){if(1&a&&(t.TgZ(0,"div",45)(1,"span"),t._uU(2),t.qZA(),t.YNc(3,z,2,1,"span",46),t.YNc(4,H,3,5,"ng-template",null,47,t.W1O),t.qZA()),2&a){const e=_.$implicit;t.xp6(2),t.Oqu(e.descricao),t.xp6(1),t.Q6J("ngIf",e.dataDesativado)}}function X(a,_){1&a&&(t.TgZ(0,"p",10),t._uU(1,"Selecione um risco para continuar."),t.qZA())}function tt(a,_){if(1&a&&(t.TgZ(0,"p",10),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij("Nenhum produto dispon\xedvel em ",e.selectedRisco.nome,".")}}function et(a,_){1&a&&(t.TgZ(0,"p",10),t._uU(1,"Informe o percentual"),t.qZA())}function ot(a,_){if(1&a&&(t.TgZ(0,"p",10),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij("Valor m\xe1ximo dispon\xedvel \xe9 ",e.selectedRisco.percentualDisponivel,"%")}}function it(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"div")(1,"app-input-number",62,63),t.NdJ("valueChanges",function(n){t.CHM(e);const c=t.MAs(2),d=t.oxw().$implicit,h=t.oxw(2);return d.percentual=n,t.KtG(h.percentualChange(c,d))}),t.qZA()()}if(2&a){const e=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("valueInput",e.percentual)("inputId","percentual-"+e.produto_Id)("mask","separator")("min",1)("required",!1)("showErrorMessage",!1)("placeholder",o.selectedRisco.percentualDisponivel+"% dispon\xedvel")("allowNegativeNumbers",!1)("autoReplaceValue",!0)}}function rt(a,_){1&a&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function at(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"button",64),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.removeProduto(n))}),t._UZ(1,"fa-icon",65),t.TgZ(2,"span",66),t._uU(3,"Excluir"),t.qZA()()}if(2&a){const e=t.oxw(3);t.xp6(1),t.Q6J("icon",e.faTrashAlt)}}function nt(a,_){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td"),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td",57)(5,"span",58),t._uU(6),t.qZA(),t._uU(7," | "),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td",59),t.YNc(11,it,3,9,"div",13),t.YNc(12,rt,2,0,"span",13),t.qZA(),t.TgZ(13,"td",60),t.YNc(14,at,4,1,"button",61),t.qZA()()),2&a){const e=_.$implicit,o=t.oxw(2);t.Gre("tiporisco-",e.produto.tipoRisco_Id,""),t.ekj("selected",e.produto.tipoRisco_Id==o.selectedRisco.id),t.xp6(3),t.Oqu(e.id),t.xp6(3),t.hij("",e.produto.tipoRisco.nome," "),t.xp6(3),t.Oqu(e.produto.descricao),t.xp6(2),t.Q6J("ngIf",61!=e.produto.id),t.xp6(1),t.Q6J("ngIf",61==e.produto.id),t.xp6(2),t.Q6J("ngIf",61!=e.produto.id)}}function st(a,_){if(1&a&&(t.TgZ(0,"div",6)(1,"div",50)(2,"p",51),t._uU(3,"Itens selecionados"),t.qZA(),t.TgZ(4,"div",52)(5,"table",53)(6,"thead")(7,"tr"),t._UZ(8,"th",54),t.TgZ(9,"th",54),t._uU(10,"Id"),t.qZA(),t.TgZ(11,"th",54),t._uU(12,"Risco"),t.qZA(),t.TgZ(13,"th",54),t._uU(14,"Produto"),t.qZA(),t.TgZ(15,"th",54),t._uU(16,"Percentual"),t.qZA(),t._UZ(17,"th",55),t.qZA()(),t.TgZ(18,"tbody"),t.YNc(19,nt,15,11,"tr",56),t.qZA()()()()()),2&a){const e=t.oxw();t.xp6(19),t.Q6J("ngForOf",e.objeto.carteiraProdutoRel)}}function lt(a,_){if(1&a&&(t.TgZ(0,"p",70),t._uU(1),t.ALo(2,"json"),t.qZA()),2&a){const e=_.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,e))}}function dt(a,_){1&a&&(t.TgZ(0,"p",70),t._uU(1,"Preencha todos os campos obrigat\xf3rios (*) corretamente para salvar"),t.qZA())}function ct(a,_){if(1&a&&(t.TgZ(0,"div",67),t.YNc(1,lt,3,3,"p",68),t.YNc(2,dt,2,0,"p",69),t.qZA()),2&a){const e=t.oxw(),o=t.MAs(1);t.xp6(1),t.Q6J("ngForOf",e.erro),t.xp6(1),t.Q6J("ngIf",o.invalid&&0==e.erro.length)}}function pt(a,_){1&a&&t._UZ(0,"span",71)}function ut(a,_){1&a&&(t.TgZ(0,"div",72),t._uU(1," Este campo \xe9 obrigat\xf3rio "),t.qZA())}let _t=(()=>{class a{constructor(e,o,n,c,d,h){var B=this;this.toastr=e,this.empresaService=o,this.produtoService=n,this.activatedRoute=c,this.setupService=d,this.dropdown=h,this.objeto=new I.Wj,this.loading=!1,this.erro=[],this.sendData=new t.vpe,this.clearData=!1,this.faPlus=C.r8p,this.faTrashAlt=C.I7k,this.faChartSimple=C.Wpq,this.faTable=C.B3e,this.faEdit=C.Xcf,this.isEditPage=!1,this.loadingCarteiras=!0,this.loadingTributacao=!1,this.carteiraRiscoColumns=S,this.allProdutos=[],this.produtosRisco=[],this.percentual="",this.tipoRiscos=[],this.selectedRisco=new M.p,this.url="",this.cmp=(O,F)=>(O>F)-(O<F),this.chartWidth="100%",this.chartHeight="70px",this.subscription=[],this.hasViewInit=!1,this.formValid=!1;var w=this.activatedRoute.params.subscribe(O=>this.isEditPage=!!O.setup_id);this.subscription.push(w),this.selectedRisco={id:1,nome:"Baixissimo",percentualDisponivel:100},this.getRiscos();var N=this.dropdown.tipoRisco.subscribe(O=>this.tipoRiscos=O.map(F=>({id:F.id,nome:F.nome,percentualDisponivel:F.percentualDisponivel})));if(this.subscription.push(N),this.url=this.activatedRoute.snapshot.pathFromRoot.map(O=>O.routeConfig?.path).join("/"),this.url.includes("empresas/cadastrar")){var R=this.empresaService.empresa.subscribe(O=>this.allProdutos=O.produto);this.subscription.push(R)}else(0,f.n)(this.produtoService.getList()).then(function(){var O=(0,v.Z)(function*(F){B.allProdutos=F,B.selectedRisco={id:1,nome:"Baixissimo",percentualDisponivel:100}});return function(F){return O.apply(this,arguments)}}())}ngOnDestroy(){this.subscription.forEach(e=>e.unsubscribe())}ngOnChanges(e){var o=this;return(0,v.Z)(function*(){e.objeto&&(o.objeto=e.objeto.currentValue,o.hasViewInit&&(o.setChartProduto(),o.setProdutos(),yield o.calculaPercentualDisponivel(),o.validatePercentual())),e.loading&&(o.loading=e.loading.currentValue),e.erro&&(o.erro=e.erro.currentValue),e.clearData&&(o.clearData=e.clearData.currentValue,o.clearData&&(delete o.produto,o.percentual=""))})()}ngAfterViewInit(){this.hasViewInit=!0;var e=window.innerWidth,o=l(".chart-container").width()??0;this.chartWidth=(100/e*o).toString()+"vw",this.setChartProduto(),setTimeout(()=>l("#tipoRisco-1").click(),300)}onResize(e){var o=window.innerWidth,n=l(".chart-container").width()??0;this.chartWidth=(100/o*n).toString()+"vw"}send(e){if(e.invalid)return this.toastr.error("Campos inv\xe1lidos"),void(this.erro=["Campos inv\xe1lidos"]);this.erro=[],this.validatePercentual(),this.formValid?this.sendData.emit(e):this.erro.forEach(o=>{this.toastr.error(o)})}setChartProduto(){let e=0,o=this.objeto.carteiraProdutoRel.filter(c=>null!=c.produto.tipoRisco).map(c=>c.produto.tipoRisco);if(o=o.filter((c,d,h)=>d===h.findIndex(B=>B.id===c.id)),o.length>0){var n=70;o.forEach(d=>n=n+=30),this.chartHeight=n+"px",this.optionsChartProduto={onClick:d=>{},indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0,0,0,0.95)",padding:{x:15,y:10},callbacks:{beforeTitle:d=>d[0].element.$context.raw.produto.tipoRisco?.nome,title:d=>""}}},scales:{xAxes:{stacked:!0,min:0,max:100,suggestedMax:100,scaleLabel:{display:!0},grid:{drawBorder:!1},ticks:{callback:function(d,h,B){return d+"%"}}},yAxes:{scaleLabel:{display:!0},stacked:!0,drawOnChartArea:o.length>0,drawBorder:o.length>0,display:o.length>0}},parsing:{yAxisKey:"produto.tipoRisco.nome",xAxisKey:"percentual"}},this.objeto.carteiraProdutoRel.sort((d,h)=>this.cmp(d.produto.tipoRisco_Id,h.produto.tipoRisco_Id)||this.cmp(d.produto.descricao,h.produto.descricao));let c=this.objeto.carteiraProdutoRel.map(d=>({type:"bar",axis:"y",label:`${d.produto.descricao}`,backgroundColor:g.O[e++],data:[d]}));this.dataProduto={datasets:c},setTimeout(()=>{this.chartProdutos.chart.update()},300)}}getRiscos(){var e=this;return(0,v.Z)(function*(){e.loading=!0,yield(0,f.n)(e.dropdown.getRisco()).then(o=>{e.tipoRiscos=o.map(n=>({id:n.id,nome:n.nome,percentualDisponivel:n.percentualDisponivel??100})),e.selectedRisco=e.tipoRiscos[0]}).finally(()=>e.loading=!1)})()}riscoChange(e){this.selectedRisco={id:e.value.id,nome:e.value.nome,percentualDisponivel:e.value.percentualDisponivel},this.calculaPercentualDisponivel(),this.setProdutos()}calculaPercentualDisponivel(){var e=this;return(0,v.Z)(function*(){0==e.tipoRiscos.length&&(yield e.getRiscos()),e.tipoRiscos=e.tipoRiscos.map(o=>{let n=e.objeto.carteiraProdutoRel.filter(h=>61!=h.produto_Id&&h.produto.tipoRisco_Id==o.id);var d=100-(n.length>0?n.map(h=>h.percentual).reduce((h,B)=>h+B):0);return o.percentualDisponivel=d=d<0?0:d>100?100:d,o}),e.selectedRisco.percentualDisponivel=e.tipoRiscos.find(o=>o.id==e.selectedRisco.id)?.percentualDisponivel??100})()}setProdutos(){let e=this.objeto.carteiraProdutoRel.map(o=>o.produto_Id);this.produtosRisco=this.allProdutos.filter(o=>o.tipoRisco_Id==this.selectedRisco.id&&null==o.dataDesativado&&!e.includes(o.id)),this.produtosRisco=this.sortProdutos(this.produtosRisco),this.percentual=""}sortProdutos(e){return e.sort((o,n)=>o.tipoRisco_Id>n.tipoRisco_Id?-1:o.tipoRisco_Id<n.tipoRisco_Id?1:o.descricao<n.descricao?-1:o.descricao>n.descricao?1:0)}adicionarProduto(){var e=this;return(0,v.Z)(function*(){if(e.produto){let c={id:0,percentual:e.percentual,carteiraSetup_Id:0,produto:e.produto,produto_Id:e.produto.id};var o=e.objeto.carteiraProdutoRel.findIndex(d=>d.produto_Id==e.produto?.id),n=e.objeto.carteiraProdutoRel.find(d=>d.produto_Id==e.produto?.id);n&&-1!=o?(c.id=n.id,e.objeto.carteiraProdutoRel.splice(o,1,c)):e.objeto.carteiraProdutoRel.push(c),e.objeto.carteiraProdutoRel.sort((d,h)=>e.cmp(d.produto.tipoRisco_Id,h.produto.tipoRisco_Id)||e.cmp(d.produto.descricao,h.produto.descricao)),e.setupService.setObject(e.objeto),delete e.produto,yield e.calculaPercentualDisponivel(),e.setProdutos(),e.setChartProduto(),e.validatePercentual()}else e.toastr.error("Selecione um produto para adicionar")})()}removeProduto(e){var o=this;return(0,v.Z)(function*(){let n=o.objeto.carteiraProdutoRel.findIndex(c=>c.id==e.id&&c.produto_Id==e.produto.id);-1!=n&&(o.objeto.carteiraProdutoRel.splice(n,1),o.setupService.setObject(o.objeto),o.setChartProduto(),o.setProdutos(),yield o.calculaPercentualDisponivel(),o.validatePercentual())})()}validatePercentual(){return this.erro=[],0==this.objeto.carteiraProdutoRel.length?(this.erro.push("Voc\xea deve selecionar pelo menos um produto."),!1):(this.formValid=!0,this.tipoRiscos.length&&this.objeto.carteiraProdutoRel.filter(e=>61!=e.produto_Id).every(e=>{var o=this.tipoRiscos.find(n=>n.id==e.produto.tipoRisco_Id);return o&&0!=o?.percentualDisponivel?(this.erro.push(`A soma do percentual dos produtos para o risco ${o.nome} deve ser 100%.`),this.formValid=!1,!1):(this.formValid=!0,!0)}),this.formValid)}percentualChange(e,o){var n=this;return(0,v.Z)(function*(){yield n.calculaPercentualDisponivel(),n.validatePercentual(),n.tipoRiscos.find(R=>R.id==o.produto.tipoRisco_Id);var h=n.objeto.carteiraProdutoRel.filter(R=>61!=R.produto_Id&&R.produto_Id!=o.produto_Id&&R.produto.tipoRisco_Id==o.produto.tipoRisco_Id).map(R=>R.percentual),B=h.length>0?h.reduce((R,O)=>R+O):0;e.max=100-B,e.input.valid&&n.setChartProduto()})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(u._W),t.Y36(y.P),t.Y36(Z.m),t.Y36(p.gz),t.Y36(j.A),t.Y36(D.V))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-form-carteira-setup"]],viewQuery:function(e,o){if(1&e&&(t.Gf(J,5),t.Gf(K,5),t.Gf(Y,5)),2&e){let n;t.iGM(n=t.CRH())&&(o.chartProdutos=n.first),t.iGM(n=t.CRH())&&(o.percentuais=n),t.iGM(n=t.CRH())&&(o.tipoRiscoModel=n)}},hostBindings:function(e,o){1&e&&t.NdJ("resize",function(c){return o.onResize(c)},!1,t.Jf7)},inputs:{objeto:"objeto",loading:"loading",erro:"erro",clearData:"clearData"},outputs:{sendData:"sendData"},features:[t.TTD],decls:65,vars:30,consts:[[1,"needs-validation",3,"ngSubmit"],["form","ngForm"],[1,"row","d-flex","flex-wrap","align-items-stretch","mb-2"],[1,"col-lg-4","col-md-4","col-sm-4","col-12"],[1,"col-12","d-flex","flex-wrap","mt-2"],[1,"col-xl-4","col-lg-5","col-md-5","col-sm-12","col-12","ps-0","pe-sm-2","pe-0"],[1,"card","card-body","mb-2"],[1,"form-row"],[1,"form-group","col-sm-12"],["for","carteiraSetup",1,"h6"],[1,"text-danger"],["type","text","name","nome","id","nome","placeholder","Digite para cadastrar nova carteira","pattern","\\S(.*\\S)?",1,"form-control","my-1",3,"ngModel","required","ngModelChange","change"],["nome","ngModel"],[4,"ngIf"],[1,"form-row","mt-2","mb-2"],[1,"d-flex","align-items-start","justify-content-start","flex-wrap","col-12"],[1,"h6","me-3","w-100"],["class","me-2 mb-2 d-flex align-items-center",4,"ngFor","ngForOf"],[1,"form-row","justify-content-center","flex-column"],[1,"form-group","col-lg-12","col-md-12","col-sm-12","col-12"],["for","produto"],["id","produto","name","produto","optionLabel","descricao","optionDisabled","dataDesativado","filterBy","descricao, tipoRisco.nome","placeholder","Selecione para adicionar",1,"form-control","novalidate",3,"options","ngModel","filter","showClear","ngModelChange"],["_produto","ngModel"],["pTemplate","item"],[1,"mt-1","px-1"],["class","text-danger",4,"ngIf"],["for","percentual"],["suffix","%",3,"valueInput","inputId","mask","min","max","required","showErrorMessage","placeholder","allowNegativeNumbers","autoReplaceValue","valueChanges"],[1,"form-group","align-items-end","px-1"],["type","button",1,"btn","btn-grey","w-100",3,"disabled","click"],[1,"col-xl-8","col-lg-7","col-md-7","col-sm-12","col-12","px-0"],["type","verticalBar",3,"options","data","height"],["chartProdutos",""],["class","card card-body mb-2",4,"ngIf"],[1,"d-flex","align-items-start","flex-wrap","p-0","mt-1","px-2"],["class","m-0",4,"ngIf"],[1,"btn","btn-primary","mr-0","ml-auto",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["campoObrigatorio",""],["class","text-danger error",4,"ngIf"],[1,"text-danger","error"],[1,"me-2","mb-2","d-flex","align-items-center"],["type","radio","name","tipoRisco",1,"mr-1","mt-1",3,"id","ngModel","value","checked","ngModelChange"],["tipoRisco","ngModel"],[1,"mb-0","ms-1",3,"for"],[1,"d-flex","align-items-center","justify-content-between"],["class","flag flag-red",3,"ngbPopover",4,"ngIf"],["ativo",""],[1,"flag","flag-red",3,"ngbPopover"],[1,"py-2","px-3"],[1,"col-12","px-2"],[1,"h6"],[1,"overflow-x-auto","w-100"],[1,"table","table-striped","table-borderless","table-editable"],[1,"bg-dark","text-white","font-weight-normal"],[1,"bg-dark","text-white","font-weight-normal",2,"width","80px"],[3,"selected","class",4,"ngFor","ngForOf"],[1,"text-right","ms-3"],[1,"font-weight-bold"],[2,"width","110px","height","43px"],[1,"td-action"],["type","button","class","btn-trash ml-auto d-block px-2 text-dark",3,"click",4,"ngIf"],["suffix","%",3,"valueInput","inputId","mask","min","required","showErrorMessage","placeholder","allowNegativeNumbers","autoReplaceValue","valueChanges"],["_percentual",""],["type","button",1,"btn-trash","ml-auto","d-block","px-2","text-dark",3,"click"],[1,"d-md-none","d-block",3,"icon"],[1,"d-md-block","d-none","btn","btn-dark"],[1,"m-0"],["class","text-red",4,"ngFor","ngForOf"],["class","text-red",4,"ngIf"],[1,"text-red"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"py-3","px-4"]],template:function(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"form",0,1),t.NdJ("ngSubmit",function(){t.CHM(n);const d=t.MAs(1);return t.KtG(o.send(d))}),t.TgZ(2,"div",2),t._UZ(3,"div",3),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"label",9),t._uU(10,"Nome: "),t.TgZ(11,"span",10),t._uU(12,"*"),t.qZA()(),t.TgZ(13,"input",11,12),t.NdJ("ngModelChange",function(d){return o.objeto.nome=d})("change",function(){t.CHM(n);const d=t.MAs(14);return t.KtG(o.objeto.nome=d.value.trim())}),t.qZA(),t.YNc(15,G,3,2,"div",13),t.qZA()()(),t.TgZ(16,"div",6)(17,"div",14)(18,"div",15)(19,"p",16),t._uU(20,"Selecione o Risco"),t.qZA(),t.YNc(21,q,5,6,"div",17),t.qZA()(),t.TgZ(22,"div",18)(23,"div",19)(24,"label",20),t._uU(25,"Produto: "),t.TgZ(26,"span",10),t._uU(27,"*"),t.qZA()(),t.TgZ(28,"p-dropdown",21,22),t.NdJ("ngModelChange",function(d){return o.produto=d}),t.YNc(30,$,6,2,"ng-template",23),t.qZA(),t.TgZ(31,"div",24),t.YNc(32,X,2,0,"p",25),t.YNc(33,tt,2,1,"p",25),t.qZA()(),t.TgZ(34,"div",19)(35,"label",26),t._uU(36,"Percentual: "),t.TgZ(37,"span",10),t._uU(38,"*"),t.qZA()(),t.TgZ(39,"app-input-number",27),t.NdJ("valueChanges",function(d){return o.percentual=d}),t.qZA(),t.TgZ(40,"div",24),t.YNc(41,et,2,0,"p",25),t.YNc(42,ot,2,1,"p",25),t.qZA()(),t.TgZ(43,"div",28)(44,"button",29),t.NdJ("click",function(){return o.adicionarProduto()}),t._uU(45," Adicionar "),t.qZA()()()()(),t.TgZ(46,"div",30)(47,"div",6)(48,"div")(49,"h6"),t._uU(50,"Divis\xe3o da carteira: "),t.TgZ(51,"span",10),t._uU(52,"*"),t.qZA()()(),t.TgZ(53,"div"),t._UZ(54,"p-chart",31,32),t.qZA()(),t.YNc(56,st,20,1,"div",33),t.qZA()()(),t.TgZ(57,"div",34),t.YNc(58,ct,3,2,"div",35),t.TgZ(59,"button",36),t.YNc(60,pt,1,0,"span",37),t.TgZ(61,"span"),t._uU(62,"Salvar"),t.qZA()()()(),t.YNc(63,ut,2,0,"ng-template",null,38,t.W1O)}if(2&e){const n=t.MAs(1),c=t.MAs(14);t.xp6(13),t.Q6J("ngModel",o.objeto.nome)("required",!0),t.xp6(2),t.Q6J("ngIf",c.touched&&c.errors),t.xp6(6),t.Q6J("ngForOf",o.tipoRiscos),t.xp6(7),t.Q6J("options",o.produtosRisco)("ngModel",o.produto)("filter",!0)("showClear",!0),t.xp6(4),t.Q6J("ngIf",null==o.selectedRisco),t.xp6(1),t.Q6J("ngIf",null!=o.selectedRisco&&0==o.produtosRisco.length),t.xp6(6),t.Q6J("valueInput",o.percentual)("inputId","percentual")("mask","separator")("min",0==o.selectedRisco.percentualDisponivel||null==o.produto?0:1)("max",o.selectedRisco.percentualDisponivel)("required",!1)("showErrorMessage",!1)("placeholder",o.selectedRisco.percentualDisponivel+"% dispon\xedvel")("allowNegativeNumbers",!1)("autoReplaceValue",!1),t.xp6(2),t.Q6J("ngIf",!o.percentual),t.xp6(1),t.Q6J("ngIf",o.percentual>o.selectedRisco.percentualDisponivel),t.xp6(2),t.Q6J("disabled",null==o.produto||""==o.percentual.toString()||o.percentual>o.selectedRisco.percentualDisponivel||0==o.percentual),t.xp6(10),t.Q6J("options",o.optionsChartProduto)("data",o.dataProduto)("height",o.chartHeight),t.xp6(2),t.Q6J("ngIf",o.objeto.carteiraProdutoRel.length>0),t.xp6(2),t.Q6J("ngIf",o.erro||n.invalid),t.xp6(1),t.Q6J("disabled",n.invalid||o.loading||!o.formValid),t.xp6(1),t.Q6J("ngIf",o.loading)}},dependencies:[s.sg,s.O5,m._Y,m.Fj,m._,m.JJ,m.JL,m.Q7,m.c5,m.On,m.F,b.BN,P.jx,T.o8,L.Lt,E.C,x.l,s.Ts,s.uU],styles:['.cdk-drop-list[_ngcontent-%COMP%]{position:relative;min-height:300px}.cdk-drop-list.cdkDrag[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;width:calc(100% - 10px);height:calc(100% - 10px);transform:translate(-50%,-50%);color:#00000073;font-size:18px;display:flex;align-items:center;justify-content:center;z-index:0}.cdk-drop-list.cdkDrag.empty[_ngcontent-%COMP%]:after{content:"Solte aqui para selecionar";border:1px #0000007a dashed}.cdk-drop-list.cdkDrag.empty[_ngcontent-%COMP%]:hover:after{border:1px #00000096 dashed;color:#00000096}.cdk-drag[_ngcontent-%COMP%]{position:relative;z-index:1;margin:0}.fade-in-right[_ngcontent-%COMP%]{animation:fade-in-right .5s forwards}.fade-out-left[_ngcontent-%COMP%]{animation:fade-out-left .5s forwards}.form-group[_ngcontent-%COMP%]{transition:.5s}@keyframes fade-in-right{0%{opacity:0;visibility:hidden;display:none;transform:translate(-100%)}20%{display:block}to{opacity:1;visibility:visible;transform:translate(0)}}@keyframes fade-out-left{0%{opacity:1;visibility:visible;transform:translate(0);display:block}20%{display:none}to{opacity:0;visibility:hidden;transform:translate(-100%)}}.data-view[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--grey-light) 50%,#ffffff 50%);border-radius:3px;background-size:200%;background-position:250%;display:flex;align-self:flex-start;position:relative;transition:.3s}.data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;padding:5px 10px;background-color:transparent;border-radius:3px}.data-view[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%], .data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{color:#fff}.data-view[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{border-radius:0 3px 3px 0;border-color:#595c5f;border-left:none}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{color:#fff}.data-view.right[_ngcontent-%COMP%]{transition:.3s;background-position:153%}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{border:1px #8f8f8f solid;border-right:none;border-radius:3px 0 0 3px}.data-view.right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{color:#212529;transition:.3s color}.mat-option[_ngcontent-%COMP%]{height:auto!important;padding:9px 11px!important;line-height:1!important}.mat-option-text[_ngcontent-%COMP%]{font-size:14px!important}.td-action[_ngcontent-%COMP%]{position:sticky;right:0}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd)   .td-action[_ngcontent-%COMP%]{background-color:#f3f3f3}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(even)   .td-action[_ngcontent-%COMP%]{background-color:#fff}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]:nth-of-type(even)   .td-action[_ngcontent-%COMP%]{background-color:#b9c8f3}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]:nth-of-type(odd)   .td-action[_ngcontent-%COMP%]{background-color:#bcc9f1}']}),a})()}}]);