<div class="modal__content py-0">
    <div class="modal__header pb-2" style="padding: 0 25px;">
        <div class="d-flex align-items-center justify-content-between flex-wrap w-100">
            <a class="link text-dark" (click)="voltar()">
                <fa-icon class="mr-1" [icon]="faChevronLeft"></fa-icon>
                <span>Voltar</span>
            </a>
            <div>
                <button class="btn btn-yellow" (click)="resetForm()">Limpar campos</button>
                <!-- <a class="btn btn-primary ml-1" [routerLink]="['..', 'excluir', plannerIdEncrypted]" *ngIf="planner.id != 0">Excluir planner</a> -->
            </div>
        </div>
        <h3 class="text-orange mt-1">Planner</h3>
    </div>
    <div class="modal__body mt-0">
        <form #form="ngForm" (ngSubmit)="send(form)" disabled class="needs-validation home editable">
            <div class="form-row mb-2">
                <div class="col-lg-8 col-md-8 col-sm-12">
                    <!-- Dados Cadastrais -->
                    <div class="form-row mb-2">
                        <div class="card card-body">
                            <div class="home__container-header mb-2">
                                <h6>Dados Cadastrais</h6>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-5 col-md-5 col-sm-12">
                                    <label for="nome">Nome Completo: <span class="text-danger">*</span></label>
                                    <input type="text"
                                           name="nome"
                                           id="nome"
                                           class="form-control"
                                           #nome="ngModel"
                                           [(ngModel)]="planner.cliente.nome"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="nome.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           required
                                           (change)="planner.cliente.nome = nome.value.trim(); saveData()"
                                           pattern="\S(.*\S)?">
                                    <div *ngIf="nome.errors">
                                        <p class="text-danger" *ngIf="nome.errors['required']">Esse campo é obrigatório</p>
                                        <p class="text-danger" *ngIf="nome.errors['pattern']">
                                            <span *ngIf="nome.errors['pattern']['requiredPattern'] == '^\\S(.*\\S)?$'">Remova os espaços antes e depois do texto.</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group col-lg-3 col-md-3 col-sm-12">
                                    <label for="perfilInvestidor">Perfil de Investidor: <span class="text-danger">*</span></label>
                                    <select class="form-control"
                                            name="perfilInvestidor"
                                            id="perfilInvestidor"
                                            [class.form-control-loading]="loadingPerfilInvestidor"
                                            #_perfilInvestidor="ngModel"
                                            [(ngModel)]="planner.cliente.perfilInvestidor_Id"
                                            [ngbPopover]="campoObrigatorio"
                                            popoverClass="popover-danger"
                                            [disablePopover]="_perfilInvestidor.errors == null"
                                            triggers="mouseenter:mouseleave"
                                            required
                                            (ngModelChange)="perfilInvestidorChange();">
                                        <option [ngValue]="undefined">Selecione</option>
                                        <option [ngValue]="item.id" *ngFor="let item of perfilInvestidor">{{ item.descricao }} </option>
                                    </select>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-12">
                                    <label for="estadoCivil">Estado Civil: <span class="text-danger">*</span>
                                    </label>
                                    <select name="estadoCivil"
                                            id="estadoCivil"
                                            class="form-control"
                                            [class.form-control-loading]="loadingEstadoCivil"
                                            #_estadoCivil="ngModel"
                                            [(ngModel)]="planner.cliente.estadoCivil_Id"
                                            [ngbPopover]="campoObrigatorio"
                                            popoverClass="popover-danger"
                                            [disablePopover]="_estadoCivil.errors == null"
                                            triggers="mouseenter:mouseleave"
                                            required
                                            (ngModelChange)="saveData()">
                                        <option [ngValue]="undefined">Selecione</option>
                                        <option [ngValue]="item.id" *ngFor="let item of estadoCivil">{{item.descricao}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-3 col-md-3 col-sm-6 col-6">
                                    <label for="cpf">CPF: <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           name="cpf"
                                           id="cpf"
                                           class="form-control"
                                           #cpf="ngModel"
                                           [(ngModel)]="planner.cliente.cpf"
                                           mask="000.000.000-00"
                                           placeHolder="000.000.000-00"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="cpf.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           required
                                           (change)="validaRG_CPF(cpf, cpf.value)"
                                           pattern="\d{3}\.?\d{3}\.?\d{3}-?\d{2}"
                                           [readonly]="isEditPage">
                                    <div *ngIf="cpf.touched && cpf.errors">
                                        <p class="text-danger" *ngIf="cpf.errors['jaExiste']">{{cpf.errors['jaExiste']}}</p>
                                        <p class="text-danger" *ngIf="cpf.errors['invalid']">Esse CPF é inválido</p>
                                    </div>
                                    <div *ngIf="!cpf.errors && cpf.touched && cpf.dirty">
                                        <p class="text-info">Após salvar, o CPF não poderá ser alterado</p>
                                    </div>
                                </div>
                                <div class="form-group col-lg-3 col-md-3 col-sm-6 col-6">
                                    <label for="rg">RG: <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           name="rg"
                                           id="rg"
                                           class="form-control"
                                           #rg="ngModel"
                                           [(ngModel)]="planner.cliente.rg"
                                           mask="00.000.000-0"
                                           placeholder="00.000.000-0"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="rg.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           required
                                           (change)="saveData(); validaRG_CPF(rg, rg.value)"
                                           pattern="\d{2}\.?\d{3}\.?\d{3}-?\d{1}">
                                    <div *ngIf="rg.errors">
                                        <p class="text-danger" *ngIf="rg.errors['jaExiste']">{{rg.errors['jaExiste']}}</p>
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-6 col-6">
                                    <label for="dataNascimento">Data de Nascimento: <span class="text-danger">*</span></label>
                                    <input type="date"
                                           name="dataNascimento"
                                           id="dataNascimento"
                                           class="form-control"
                                           #dataNascimento="ngModel"
                                           [(ngModel)]="planner.cliente.dataNascimento"
                                           (ngModelChange)="calculaIdade()"
                                           (change)="saveData(); validateDataNascimento()"
                                           [min]="  "
                                           [max]="dataNascimentoMax"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="dataNascimento.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           required>
                                    <div *ngIf="dataNascimento.touched && dataNascimento.errors">
                                        <p class="text-danger" *ngIf="dataNascimento.errors['min']"><small>Data mínima é {{dataNascimentoMin}}</small></p>
                                        <p class="text-danger" *ngIf="dataNascimento.errors['max']"><small>Data máxima é {{dataNascimentoMax}}</small></p>
                                    </div>
                                    <!-- [formControl]="dataNascimento"      -->
                                </div>
                                <div class="form-group col-lg-2 col-md-2 col-sm-6 col-6">
                                    <label for="idade">Idade: <span class="text-danger">*</span></label>
                                    <app-input-number [valueInput]="planner.cliente.idade"
                                                      (valueChanges)="planner.cliente.idade = $event; saveData();"
                                                      [inputId]="'idade'"
                                                      [mask]="'0*'"
                                                      [suffix]="' anos'"
                                                      [readonly]="true"
                                                      [required]="true"
                                                      [showErrorMessage]="true"
                                                      [allowNegativeNumbers]="false"
                                                      [autoReplaceValue]="true"></app-input-number>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                    <label for="email">E-mail: <span class="text-danger">*</span></label>
                                    <input type="email"
                                           [email]="true"
                                           name="email"
                                           id="email"
                                           class="form-control"
                                           #email="ngModel"
                                           [(ngModel)]="planner.cliente.email"
                                           placeholder="example@gmail.com"
                                           [ngbPopover]="campoObrigatorio"
                                           popoverClass="popover-danger"
                                           [disablePopover]="email.errors == null"
                                           triggers="mouseenter:mouseleave"
                                           required
                                           (change)="saveData()"
                                           [pattern]="emailPattern">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row mb-2">
                        <!-- Valores -->
                        <div class="col-lg-6 col-md-6 col-sm-12 col-12 pl-0 pr-0">
                            <div class="home__container ">
                                <div class="home__container-header mb-2">
                                    <h6>Valores</h6>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12 d-lg-block d-md-block">
                                        <label for="receita">Receita <small>(R$)</small>: <span class="text-danger">*</span></label>
                                        <app-input-number #receita
                                                          [valueInput]="planner.cliente.receita"
                                                          (valueChanges)="planner.cliente.receita = $event; saveData();"
                                                          (ngModelChanged)="validaReceitaDespesa($event)"
                                                          [inputId]="'receita'"
                                                          [mask]="'separator'"
                                                          prefix="R$ "
                                                          [min]="1"
                                                          [max]="100000000"
                                                          [required]="true"
                                                          [allowNegativeNumbers]="true"
                                                          placeholder="R$ 00,00"
                                                          [showErrorMessage]="true"
                                                          [autoReplaceValue]="true"></app-input-number>
                                    </div>
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                        <label for="despesa">Despesas <small>(R$)</small>: <span class="text-danger">*</span></label>
                                        <app-input-number #despesa
                                                          [valueInput]="planner.cliente.despesa"
                                                          (valueChanges)="planner.cliente.despesa = $event; saveData();"
                                                          (ngModelChanged)="validaReceitaDespesa($event)"
                                                          [inputId]="'despesa'"
                                                          [mask]="'separator'"
                                                          prefix="R$ "
                                                          [min]="1"
                                                          [max]="100000000"
                                                          [required]="true"
                                                          [allowNegativeNumbers]="true"
                                                          placeholder="R$ 00,00"
                                                          [showErrorMessage]="true"
                                                          [autoReplaceValue]="true"></app-input-number>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Taxas -->
                        <div class="col-lg-6 col-md-6 col-sm-12 col-12 pr-0 pl-0">
                            <div class="home__container">
                                <div class="home__container-header mb-2">
                                    <h6>Taxas</h6>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12 d-lg-block d-md-block">
                                        <label for="taxaSelic">Taxa Selic <small>(%)</small>: <span class="text-danger">*</span></label>
                                        <app-input-number [valueInput]="planner.taxaSelic"
                                                          (valueChanges)="planner.taxaSelic = $event; saveData();"
                                                          [inputId]="'taxaSelic'"
                                                          [mask]="'separator'"
                                                          suffix="%"
                                                          [max]="100"
                                                          [required]="true"
                                                          [showErrorMessage]="false"
                                                          [allowNegativeNumbers]="true"
                                                          [placeholder]="'0,00%'"
                                                          [showErrorMessage]="false"
                                                          [autoReplaceValue]="true"></app-input-number>
                                    </div>
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                        <label for="taxaIpca">Taxa IPCA <small>(%)</small>: <span class="text-danger">*</span></label>
                                        <app-input-number [valueInput]="planner.taxaIpca"
                                                          (valueChanges)="planner.taxaIpca = $event; saveData();"
                                                          [inputId]="'taxaIpca'"
                                                          [mask]="'separator'"
                                                          suffix="%"
                                                          [max]="100"
                                                          [required]="true"
                                                          [showErrorMessage]="false"
                                                          [allowNegativeNumbers]="true"
                                                          [placeholder]="'0,00%'"
                                                          [showErrorMessage]="false"
                                                          [autoReplaceValue]="true"></app-input-number>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Capacidade de Risco -->
                    <div class="form-row mb-2">
                        <div class="card card-body">
                            <div class="home__container-header mb-4">
                                <h6>Capacidade de Risco</h6>
                            </div>
                            <div class="form-row">
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12 px-0">
                                    <div class="form-container">
                                        <div class="form-container-title font-weight-bold">Reserva de Emergência</div>
                                        <div class="form-container-body">
                                            <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-1">
                                                <label for="rE_Sugerido"> Sugerida <small>(R$)</small>:</label>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rE_Sugerido"
                                                       name="rE_Sugerido"
                                                       #rE_Sugerido="ngModel"
                                                       [(ngModel)]="planner.rE_Sugerido"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="R$ 00,00"
                                                       prefix="R$ "
                                                       readonly>
                                            </div>
                                            <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-0">
                                                <label for="rE_Planejado"> Planejada <small>(R$)</small>:</label>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="rE_Planejado"
                                                       name="rE_Planejado"
                                                       #rE_Planejado="ngModel"
                                                       [(ngModel)]="planner.rE_Planejado"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="R$ 00,00"
                                                       prefix="R$ "
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12 px-0">
                                    <div class="form-container mb-0">
                                        <div class="form-container-title font-weight-bold">Risco</div>
                                        <div class="form-container-body">
                                            <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-1">
                                                <label for="riscoAssumido"> Assumido <small>(%)</small>:</label>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="riscoAssumido"
                                                       name="riscoAssumido"
                                                       #riscoAssumido="ngModel"
                                                       [(ngModel)]="planner.riscoAssumido"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="R$ 00,00"
                                                       suffix="%"
                                                       readonly>
                                            </div>
                                            <div class="form-group col-lg-6 col-md-6 col-sm-6 pr-0">
                                                <label for="riscoTolerado"> Tolerado <small>(%)</small>:</label>
                                                <input type="text"
                                                       class="form-control form-control-number"
                                                       id="riscoTolerado"
                                                       name="riscoTolerado"
                                                       #riscoTolerado="ngModel"
                                                       [(ngModel)]="planner.riscoTolerado"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="false"
                                                       placeholder="R$ 00,00" suffix="%"
                                                       suffix="%"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-12">
                    <!-- Descrição -->
                    <div class="form-row mb-2">
                        <div class="card card-body">
                            <div class="home__container-header mb-2">
                                <h6>Descrição</h6>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                    <label for="descricao">Observações do planner: <span class="text-danger">*</span></label>
                                    <textarea type="text"
                                              name="descricao"
                                              id="descricao"
                                              class="form-control"
                                              #descricao="ngModel"
                                              [(ngModel)]="planner.descricao"
                                              [ngbPopover]="campoObrigatorio"
                                              popoverClass="popover-danger"
                                              [disablePopover]="descricao.errors == null"
                                              triggers="mouseenter:mouseleave"
                                              (change)="planner.descricao = descricao.value.trim(); saveData()"
                                              required
                                              pattern="\S(.*\S)?">
                                        </textarea>
                                    <div *ngIf="descricao.errors">
                                        <p class="text-danger" *ngIf="descricao.errors['pattern']">
                                            <span *ngIf="descricao.errors['pattern']['requiredPattern'] == '^\\S(.*\\S)?$'">Remova os espaços antes e depois do texto.</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Analista responsável -->
                    <div class="form-row mb-2">
                        <div class="card card-body">
                            <div class="home__container-header mb-2">
                                <h6>Analista responsável</h6>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                    <label for="account">Analista responsável: <span class="text-danger">*</span></label>
                                    <div *ngIf="account?.perfilAcesso_Id != 3">
                                        <p-dropdown
                                                    class="form-control"
                                                    id="account"
                                                    name="account"
                                                    #_account="ngModel"
                                                    [(ngModel)]="planner.account_Id"
                                                    [class.form-control-loading]="loadingUsuarios"
                                                    [disabled]="loadingCarteiraSetup"
                                                    [options]="listUsuarios"
                                                    optionLabel="name"
                                                    optionValue="id"
                                                    optionDisabled="dataDesativado"
                                                    [filter]="true"
                                                    filterBy="name, email"
                                                    [showClear]="true"
                                                    [placeholder]="loadingUsuarios ? 'Carregando' : 'Selecione para adicionar'"
                                                    [required]="true"
                                                    (ngModelChange)="planner.cliente.account_Id = _account.value">
                                            <ng-template let-item pTemplate="item">
                                                <p class="d-flex align-items-center justify-content-between">
                                                    <span>{{item.name}}</span>
                                                    <span class="flag flag-red"
                                                          *ngIf="item.dataDesativado"
                                                          [ngbPopover]="ativo"> Inativo </span>
                                                    <ng-template #ativo>
                                                        <span class="py-2 px-3">Desativado em {{item.dataDesativado | date : "dd/MM/yyyy" : 'UTC' }} </span>
                                                    </ng-template>
                                                </p>
                                                <p>{{item.email}}</p>
                                            </ng-template>
                                        </p-dropdown>
                                        <div *ngIf="_account.errors">
                                            <p class="text-danger" *ngIf="_account.errors['required']">Esse campo é obrigatório</p>
                                        </div>
                                    </div>
                                    <input type="text" *ngIf="account?.perfilAcesso_Id == 3"
                                           class="form-control"
                                           id="account"
                                           name="account"
                                           #_account="ngModel"
                                           [(ngModel)]="planner.account.name"
                                           readonly
                                           disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Aposentadoria -->
                    <div class="form-row mb-2">
                        <div class="home__container table-responsive mb-2">
                            <table class="table table-editable w-100 d-md-table d-sm-table mb-0">
                                <thead class="primary">
                                    <tr>
                                        <th></th>
                                        <th>Aposentadoria</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Idade</b></small>
                                        </td>
                                        <td>
                                            <app-input-number [valueInput]="planner.cliente.idadeAposentadoria"
                                                              (valueChanges)="planner.cliente.idadeAposentadoria = $event; saveData();"
                                                              [inputId]="'idadeAposentadoria'"
                                                              [mask]="'0*'"
                                                              [suffix]="' anos'"
                                                              [min]="planner.cliente.idade ? planner.cliente.idade : 20"
                                                              [max]="100"
                                                              [required]="true"
                                                              placeholder="Entre {{planner.cliente.idade ? planner.cliente.idade : 20}} e 100 anos"
                                                              [showErrorMessage]="false"
                                                              [allowNegativeNumbers]="false"
                                                              [autoReplaceValue]="true"></app-input-number>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Renda Mensal </b>(R$)</small>
                                        </td>
                                        <td>
                                            <app-input-number [valueInput]="planner.cliente.rendaMensalAposentadoria"
                                                              (valueChanges)="planner.cliente.rendaMensalAposentadoria = $event; saveData();"
                                                              [inputId]="'rendaMensalAposentadoria'"
                                                              [mask]="'separator.5'"
                                                              [thousandSeparator]="'.'"
                                                              [decimalMarker]="','"
                                                              [prefix]="'R$'"
                                                              [min]="1"
                                                              [max]="100000000"
                                                              [required]="true"
                                                              [placeholder]="'R$ 00,00'"
                                                              [showErrorMessage]="false"
                                                              [autoReplaceValue]="true"></app-input-number>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="bg-light px-3 text-right" style="white-space: nowrap;">
                                            <small><b>Rentabilidade</b> (%)</small>
                                        </td>
                                        <td>
                                            <app-input-number [valueInput]="planner.cliente.rentabilidadeAposentadoria"
                                                              (valueChanges)="planner.cliente.rentabilidadeAposentadoria = $event; saveData();"
                                                              [inputId]="'rentabilidadeAposentadoria'"
                                                              [mask]="'separator.5'"
                                                              [suffix]="'%'"
                                                              [max]="100"
                                                              [required]="true"
                                                              [showErrorMessage]="false"
                                                              [allowNegativeNumbers]="true"
                                                              [placeholder]="'0,00%'"
                                                              [showErrorMessage]="false"
                                                              [autoReplaceValue]="true"></app-input-number>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Fluxos Pontuais -->
                    <div class="form-row mb-2">
                        <div class="home__container table-responsive mb-2">
                            <table class="table table-editable w-100 mb-0">
                                <thead class="primary">
                                    <tr>
                                        <th colspan="3" class="pl-4">
                                            <p class="text-center d-flex align-items-center"> Fluxos Pontuais <a class="btn p-0 ml-auto text-white" (click)="adicionarFLuxoPontual()" title="Adicionar">
                                                    <fa-icon [icon]="faPlus"></fa-icon>
                                                </a>
                                            </p>
                                        </th>
                                    </tr>
                                    <tr class="subheader">
                                        <th class="pl-4">Idade</th>
                                        <th>Valor <small>(R$)</small></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of planner.planejamentoFluxosPontuais; index as i">
                                        <td class="pl-4">
                                            <app-input-number [valueInput]="item.idade"
                                                              (valueChanges)="item.idade = $event; saveData();"
                                                              [inputId]="'idade-' + i"
                                                              [mask]="'0*'"
                                                              [suffix]="' anos'"
                                                              [min]="1"
                                                              [max]="100"
                                                              [required]="true"
                                                              [showErrorMessage]="false"
                                                              [allowNegativeNumbers]="false"
                                                              [autoReplaceValue]="true"></app-input-number>
                                        </td>
                                        <td>
                                            <app-input-number [valueInput]="item.valor"
                                                              (valueChanges)="item.valor = $event; saveData();"
                                                              [inputId]="'valor-' + i"
                                                              [mask]="'separator'"
                                                              placeholder="R$ 00,00"
                                                              prefix="R$ "
                                                              [required]="true"
                                                              [showErrorMessage]="false"
                                                              [allowNegativeNumbers]="true"
                                                              [showErrorMessage]="false"
                                                              [autoReplaceValue]="true"></app-input-number>
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-trash d-inline" (click)="removerFluxoPontual(item)" title="Remover linha">
                                                <fa-icon [icon]="faTrash"></fa-icon>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr *ngIf="planner.planejamentoFluxosPontuais.length == 0">
                                        <td class="py-2 pl-4 text-grey" colspan="3">Nenhum registro</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                    <!-- Cálculos -->
                    <div class="form-row mb-2">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Cálculos</h6>
                            </div>
                            <div class="form-row">
                                <div class="table-responsive">
                                    <table class="table table-editable">
                                        <thead class="primary">
                                            <tr>
                                                <th></th>
                                                <th>Baixíssimo</th>
                                                <th>Baixo</th>
                                                <th>Moderado</th>
                                                <th>Arrojado</th>
                                                <th style="white-space: nowrap;">Super Arrojado</th>
                                                <th>Hedge</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="px-3 bg-light text-right"><small><b>Sugestão</b></small></td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Baixissimo"
                                                           name="sugestao_Baixissimo"
                                                           #sugestao_Baixissimo="ngModel"
                                                           [(ngModel)]="planner.sugestao_Baixissimo"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Baixo"
                                                           name="sugestao_Baixo"
                                                           #sugestao_Baixo="ngModel"
                                                           [(ngModel)]="planner.sugestao_Baixo"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Moderado"
                                                           name="sugestao_Moderado"
                                                           #sugestao_Moderado="ngModel"
                                                           [(ngModel)]="planner.sugestao_Moderado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Arrojado"
                                                           name="sugestao_Arrojado"
                                                           #sugestao_Arrojado="ngModel"
                                                           [(ngModel)]="planner.sugestao_Arrojado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_SuperArrojado"
                                                           name="sugestao_SuperArrojado"
                                                           #sugestao_SuperArrojado="ngModel"
                                                           [(ngModel)]="planner.sugestao_SuperArrojado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Hedge"
                                                           name="sugestao_Hedge"
                                                           #sugestao_Hedge="ngModel"
                                                           [(ngModel)]="planner.sugestao_Hedge"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="sugestao_Total"
                                                           name="sugestao_Total"
                                                           #sugestao_Total="ngModel"
                                                           [(ngModel)]="planner.sugestao_Total"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-3 bg-light text-right"><small><b>Plano</b></small></td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Baixissimo"
                                                           name="plano_Baixissimo"
                                                           #plano_Baixissimo="ngModel"
                                                           [(ngModel)]="planner.plano_Baixissimo"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Baixo"
                                                           name="plano_Baixo"
                                                           #plano_Baixo="ngModel"
                                                           [(ngModel)]="planner.plano_Baixo"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Moderado"
                                                           name="plano_Moderado"
                                                           #plano_Moderado="ngModel"
                                                           [(ngModel)]="planner.plano_Moderado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Arrojado"
                                                           name="plano_Arrojado"
                                                           #plano_Arrojado="ngModel"
                                                           [(ngModel)]="planner.plano_Arrojado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_SuperArrojado"
                                                           name="plano_SuperArrojado"
                                                           #plano_SuperArrojado="ngModel"
                                                           [(ngModel)]="planner.plano_SuperArrojado"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Hedge"
                                                           name="plano_Hedge"
                                                           #plano_Hedge="ngModel"
                                                           [(ngModel)]="planner.plano_Hedge"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           id="plano_Total"
                                                           name="plano_Total"
                                                           #plano_Total="ngModel"
                                                           [(ngModel)]="planner.plano_Total"
                                                           mask="separator"
                                                           thousandSeparator="."
                                                           decimalMarker=","
                                                           prefix="R$ "
                                                           readonly>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Investimento -->
                    <div class="form-row mb-2">
                        <div class="home__container">
                            <div class="home__container-header mb-2 position-relative">
                                <h6>Investimentos</h6>
                                <a class="btn btn-primary" [routerLink]="['investimento']">Adicionar</a>
                            </div>
                            <div class="form-row">
                                <p-table [value]="planner.planejamentoInvestimento"
                                         [responsive]="true"
                                         responsiveLayout="scroll"
                                         class="table table-editable"
                                         emptyMessage="Nenhum registro">
                                    <ng-template pTemplate="header">
                                        <tr class="primary">
                                            <th class="text-right">Investimento</th>
                                            <th style="white-space: nowrap;">Custos/Taxas</th>
                                            <th style="white-space: nowrap;">Rentab. Bruta</th>
                                            <th style="white-space: nowrap;">Rentab. Liquida</th>
                                            <th style="white-space: nowrap;">Montante Atual</th>
                                            <!-- <th style="white-space: nowrap;">Montante Sugerido</th>
                                            <th style="white-space: nowrap;">Plano de Ação</th> -->
                                            <th class="td-actions"></th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-item let-index="rowIndex">
                                        <tr>
                                            <td class=" px-3 bg-light text-right" style="white-space: nowrap;">
                                                <span class="small font-weight-bold">{{ item.investimento.descricao}}</span>
                                            </td>
                                            <td>
                                                <app-input-number [valueInput]="item.custosTaxas"
                                                                  (valueChanges)="item.custosTaxas = $event;saveData();"
                                                                  [inputId]="'investimento-custosTaxas-' + item.investimento_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [required]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td>
                                                <app-input-number [valueInput]="item.rentabilidade"
                                                                  (valueChanges)="item.rentabilidade = $event;saveData();"
                                                                  [inputId]="'investimento-rentabilidade-' + item.investimento_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [required]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td>
                                                <app-input-number [valueInput]="item.rentabilidadeLiquida"
                                                                  (valueChanges)="item.rentabilidadeLiquida = $event"
                                                                  [inputId]="'investimento-rentabilidadeLiquida-' + item.investimento_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td [title]="'Líquido ' + formatReais(item.valorLiquido_MontanteAtual)">
                                                <app-input-number [valueInput]="item.montanteAtual"
                                                                  (valueChanges)="item.montanteAtual = $event; saveData();"
                                                                  [inputId]="'investimento-montanteAtual-' + item.investimento_Id"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [min]="1"
                                                                  [required]="true"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td class="td-actions">
                                                <a class="btn btn-trash" title="Remover linha" (click)="removerInvestimento(item)">
                                                    <fa-icon [icon]="faTrash"></fa-icon>
                                                </a>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="footer">
                                        <tr *ngIf="planner.planejamentoInvestimento.length > 0" class="bg-light" [class.bg-danger]="somaInvestimentos.somaSugerido < 0 || somaInvestimentos.somaPlanoAcao < 0 ">
                                            <td class="px-3 bg-light text-right position-sticky" style="white-space: nowrap;">
                                                <small><b>Total</b></small>
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <app-input-number [valueInput]="somaInvestimentos.somaMontanteAtual"
                                                                  [inputId]="'somaMontanteAtual'"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td></td>
                                            <td [attr.colspan]="4" class="py-2 px-2 text-grey"> Nenhum registro </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </div>
                    </div>
                    <!-- Produto -->
                    <div class="form-row mb-2">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Portifólio</h6>
                                <div *ngIf="planner.planejamentoInvestimento.length > 0"
                                     class="d-flex justify-content-end align-items-center w-100">
                                    <div class="col-lg-4 col-md-5 col-sm-6 col-8 px-0">
                                        <p-dropdown class="form-control"
                                                    id="carteirasSetup"
                                                    name="carteirasSetup"
                                                    #_carteirasSetup="ngModel"
                                                    [class.form-control-loading]="loadingCarteiraSetup"
                                                    [disabled]="loadingCarteiraSetup"
                                                    [options]="carteirasSetup"
                                                    [(ngModel)]="planner.carteiraSetup_Id"
                                                    optionLabel="nome"
                                                    optionValue="id"
                                                    optionDisabled="dataDesativado"
                                                    [filter]="true"
                                                    filterBy="nome"
                                                    [showClear]="true"
                                                    placeholder="Selecione setup para carregar produtos"
                                                    (ngModelChange)="carteiraSetupChange(_carteirasSetup)"
                                                    [required]="true">
                                            <ng-template let-item pTemplate="item">
                                                <div class="d-flex align-items-center justify-content-between">
                                                    <span>{{item.nome}}</span>
                                                    <span class="flag flag-red"
                                                          *ngIf="item.dataDesativado"
                                                          [ngbPopover]="ativo"> Inativo </span>
                                                    <ng-template #ativo>
                                                        <div class="py-2 px-3">Desativado em {{item.dataDesativado | date : "dd/MM/yyyy" : 'UTC' }} </div>
                                                    </ng-template>
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                    </div>
                                    <!-- || (planner.planejamentoProduto.length == 1 && planner.planejamentoProduto[0].produto_Id == 61 && planner.carteiraSetup.carteiraProdutoRel.length == 1 && planner.carteiraSetup.carteiraProdutoRel[0].produto_Id != 61) -->
                                    <div *ngIf="planner.carteiraSetup_Id != 0">
                                        <button type="button" *ngIf="mudouCarteiraSetup || planner.planejamentoProduto[0].produto_Id == 61"
                                                triggers="mouseenter:mouseleave"
                                                class="btn btn-primary ml-1 d-flex align-items-center {{form.invalid || loading ? 'disabled-button' : ''}}"
                                                (click)="carregarProdutos(form)"
                                                [disabled]="form.invalid || loading">
                                            <span>Carregar setup e salvar</span>
                                        </button>
                                        <a class="link ml-3" [routerLink]="['produto']"
                                           *ngIf="planner.planejamentoProduto.length > 1 && !mudouCarteiraSetup"> Adicionar outros produtos </a>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <p class="text-danger px-2" *ngIf="planner.planejamentoInvestimento.length == 0">* Insira um investimento para adicionar um produto</p>
                                <div class="w-100">
                                    <div class="w-100 d-flex flex-wrap my-2">
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="custosTaxas" 
                                                        name="custosTaxas" 
                                                        #custosTaxas="ngModel" 
                                                        [(ngModel)]="colsProdutos.custosTaxas">
                                            <label for="custosTaxas" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="custosTaxas.value" [class.text-white]="custosTaxas.value" [class.bg-light.text-dark]="!custosTaxas.value"><small>Custos/Taxas</small></label>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="rentabLiquida" 
                                                        name="rentabLiquida" 
                                                        #rentabLiquida="ngModel" 
                                                        [(ngModel)]="colsProdutos.rentabLiquida">
                                            <label for="rentabLiquida" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="rentabLiquida.value" [class.text-white]="rentabLiquida.value" [class.bg-light.text-dark]="!rentabLiquida.value"><small>Rentab. Liquida</small></label>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="rentabBruta" 
                                                        name="rentabBruta" 
                                                        #rentabBruta="ngModel" 
                                                        [(ngModel)]="colsProdutos.rentabBruta">
                                            <label for="rentabBruta" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="rentabBruta.value" [class.text-white]="rentabBruta.value" [class.bg-light.text-dark]="!rentabBruta.value"><small>Rentab. Bruta</small></label>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="montanteSugerido" 
                                                        name="montanteSugerido" 
                                                        #montanteSugerido="ngModel" 
                                                        [(ngModel)]="colsProdutos.montanteSugerido">
                                            <label for="montanteSugerido" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="montanteSugerido.value" [class.text-white]="montanteSugerido.value" [class.bg-light.text-dark]="!montanteSugerido.value"><small>Montante Sugerido</small></label>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="planoAcao" 
                                                        name="planoAcao" 
                                                        #planoAcao="ngModel" 
                                                        [(ngModel)]="colsProdutos.planoAcao">
                                            <label for="planoAcao" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="planoAcao.value" [class.text-white]="planoAcao.value" [class.bg-light.text-dark]="!planoAcao.value"><small>Plano Ação</small></label>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input type="checkbox" hidden 
                                                        id="percentual" 
                                                        name="percentual" 
                                                        #percentual="ngModel" 
                                                        [(ngModel)]="colsProdutos.percentual">
                                            <label for="percentual" class="d-block py-1 px-2" style="cursor: pointer" [class.bg-dark]="percentual.value" [class.text-white]="percentual.value" [class.bg-light.text-dark]="!percentual.value"><small>Percentual</small></label>
                                        </div>
                                    </div>
                                </div>
                                
                                <p-table [value]="planner.planejamentoProduto"
                                         [responsive]="true"
                                         responsiveLayout="scroll"
                                         class="table table-editable"
                                         emptyMessage="Nenhum registro"
                                         [resizableColumns]="true"
                                         columnResizeMode="expand">
                                    <ng-template pTemplate="header" let-columns>
                                        <tr class="primary">
                                            <th pResizableColumn class="text-right px-3 pe-0" >Risco |</th>
                                            <th pResizableColumn class="text-left px-3 ps-1 position-sticky" >Produto</th>
                                            <th pResizableColumn  *ngIf="custosTaxas.value">Custos/Taxas</th>
                                            <th pResizableColumn  *ngIf="rentabBruta.value">Rentab. Bruta</th>
                                            <th pResizableColumn  *ngIf="rentabLiquida.value">Rentab. Liquida</th>
                                            <th pResizableColumn  *ngIf="montanteSugerido.value">Montante Sugerido</th>
                                            <th pResizableColumn  *ngIf="planoAcao.value">Plano de Ação</th>
                                            <th pResizableColumn  *ngIf="percentual.value">Percentual (~)</th>
                                            <th class="td-actions"></th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-item let-index="rowIndex">
                                        <tr>
                                            <td pResizableColumn class="px-3 pe-0 bg-light text-right">
                                                <small><b>{{item.produto.tipoRisco.nome}}</b> |</small>
                                            </td>
                                            <td pResizableColumn class="px-3 ps-1 bg-light text-left position-sticky">
                                                <small><b>{{ item.produto.descricao }}</b> </small>
                                            </td>
                                            <td pResizableColumn *ngIf="custosTaxas.value">
                                                <app-input-number *ngIf="item.produto_Id != 61"
                                                                  [valueInput]="item.custosTaxas"
                                                                  (valueChanges)="item.custosTaxas = $event; saveData()"
                                                                  [inputId]="'produto-custosTaxas-' + item.produto_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [required]="true"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                                <span *ngIf="item.produto_Id == 61" class="d-block w-100 text-center">-</span>
                                            </td>
                                            <td pResizableColumn *ngIf="rentabBruta.value">
                                                <app-input-number *ngIf="item.produto_Id != 61"
                                                                  [valueInput]="item.rentabilidade"
                                                                  (valueChanges)="item.rentabilidade = $event; saveData()"
                                                                  [inputId]="'produto-rentabilidade-' + item.produto_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [required]="true"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                                <span *ngIf="item.produto_Id == 61" class="d-block w-100 text-center">-</span>
                                            </td>
                                            <td pResizableColumn *ngIf="rentabLiquida.value">
                                                <app-input-number *ngIf="item.produto_Id != 61"
                                                                  [valueInput]="item.rentabilidadeLiquida"
                                                                  (valueChanges)="item.rentabilidadeLiquida = $event"
                                                                  [inputId]="'produto-rentabilidadeLiquida-' + item.produto_Id"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                                <span *ngIf="item.produto_Id == 61" class="d-block w-100 text-center">-</span>
                                            </td>
                                            <td pResizableColumn *ngIf="montanteSugerido.value" [title]="'Líquido ' + formatReais(item.valorLiquido_MontanteAtual)">
                                                <app-input-number [valueInput]="item.sugerido"
                                                                  (valueChanges)="item.sugerido = $event"
                                                                  [inputId]="'produto-sugerido-' + item.produto_Id"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [min]="0"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td pResizableColumn *ngIf="planoAcao.value" [title]="'Líquido ' + formatReais(item.valorLiquido_PlanoAcao)">
                                                <app-input-number [valueInput]="item.planoAcao"
                                                                  (valueChanges)="item.planoAcao = $event; saveData()"
                                                                  [inputId]="'produto-planoAcao-' + item.produto_Id"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [min]="0"
                                                                  [required]="true"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [readonly]="item.produto_Id == 61"
                                                                  [disabled]="item.produto_Id == 61"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td pResizableColumn *ngIf="percentual.value">
                                                <app-input-number [valueInput]="item.percentual"
                                                                  (valueChanges)="item.percentual = $event"
                                                                  [inputId]="'produto-percentual-' + item.produto_Id"
                                                                  [mask]="'separator'"
                                                                  suffix="%"
                                                                  [min]="0"
                                                                  [max]="100"
                                                                  [showErrorMessage]="false"
                                                                  [allowNegativeNumbers]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td class="td-actions">
                                                <a class="btn btn-trash" *ngIf="item.produto.id != 61" (click)="removerProduto(item)" title="Remover linha"> <!--  Conta corrente não pode ser excluido-->
                                                    <fa-icon [icon]="faTrash"></fa-icon>
                                                </a>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="footer">
                                        <tr *ngIf="planner.planejamentoProduto.length > 0" class="bg-light" [class.bg-danger]="somaProdutos.somaPercentual < 0 || somaProdutos.somaPercentual > 100 ">
                                            <td></td>
                                            <td class="px-3 bg-light text-right position-sticky" style="white-space: nowrap;">
                                                <small><b>Total</b></small>
                                            </td>
                                            <td *ngIf="custosTaxas.value"></td>
                                            <td *ngIf="rentabBruta.value"></td>
                                            <td *ngIf="rentabLiquida.value"></td>
                                            <td *ngIf="montanteSugerido.value">
                                                <app-input-number [valueInput]="somaProdutos.somaSugerido"
                                                                  (valueChanges)="somaProdutos.somaSugerido = $event"
                                                                  [inputId]="'somaSugerido'"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td *ngIf="planoAcao.value">
                                                <app-input-number [valueInput]="somaProdutos.somaPlanoAcao"
                                                                  (valueChanges)="somaProdutos.somaPlanoAcao = $event"
                                                                  [inputId]="'somaPlanoAcao'"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td *ngIf="percentual.value">
                                                <app-input-number [valueInput]="somaProdutos.somaPercentual"
                                                                  (valueChanges)="somaProdutos.somaPercentual = $event"
                                                                  [inputId]="'somaPercentual'"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td></td>
                                        </tr>
                                        <tr *ngIf="somaProdutos.somaPercentual > 100" class="bg-light" [class.bg-danger]="somaProdutos.somaPercentual < 0 || somaProdutos.somaPercentual > 100 ">
                                            <td></td>
                                            <td class="px-3 bg-light text-right position-sticky" style="white-space: nowrap;">
                                                <small><b>Diferença</b></small>
                                            </td>
                                            <td colspan="4"></td>
                                            <td>
                                                <app-input-number [valueInput]="somaProdutos.diferencaPlanoAcao"
                                                                  (valueChanges)="somaProdutos.diferencaPlanoAcao = $event"
                                                                  [inputId]="'diferencaPlanoAcao'"
                                                                  [mask]="'separator.2'"
                                                                  prefix="R$ "
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [allowNegativeNumbers]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td>
                                                <app-input-number [valueInput]="somaProdutos.diferencaPercentual"
                                                                  (valueChanges)="somaProdutos.diferencaPercentual = $event"
                                                                  [inputId]="'diferencaPercentual'"
                                                                  [mask]="'separator.2'"
                                                                  suffix="%"
                                                                  [required]="false"
                                                                  [showErrorMessage]="false"
                                                                  [readonly]="true"
                                                                  [disabled]="true"
                                                                  [allowNegativeNumbers]="true"
                                                                  [autoReplaceValue]="true"></app-input-number>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td></td>
                                            <td [attr.colspan]="9" class="py-2 px-2 text-grey"> Nenhum registro </td>
                                            <td></td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </div>
                    </div>
                    <!-- Solução Inicial -->
                    <div class="form-row mb-2">
                        <div class="home__container">
                            <div class="home__container-header mb-2">
                                <h6>Solução Inicial</h6>
                            </div>
                            <div class="form-row table-responsive mb-2">
                                <table class="table table-editable mb-0">
                                    <thead>
                                        <tr class="primary">
                                            <th colspan="6" class="text-center p-2">
                                                <h6>Agregando Valor</h6>
                                            </th>
                                        </tr>
                                        <tr class="">
                                            <th colspan="2" class="text-right primary">Montante Total</th>
                                            <th class="p-0">
                                                <input type="text"
                                                       class="form-control form-control-solucaoInicial"
                                                       id="solucao_montante_Atual"
                                                       name="solucao_montante_Atual"
                                                       #solucao_montante_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.montante"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true">
                                            </th>
                                            <th class="primary">Exposição a Risco</th>
                                            <th class="p-0" colspan="2">
                                                <input type="text"
                                                       class="form-control form-control-solucaoInicial"
                                                       id="solucao_riscoAssumido_Atual"
                                                       name="solucao_riscoAssumido_Atual"
                                                       #solucao_riscoAssumido_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.riscoAssumido"
                                                       mask="separator.5"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [readOnly]="true">
                                            </th>
                                        </tr>
                                        <tr class="subheader" class="primary">
                                            <th style="white-space: nowrap;" class="text-right">Carteira</th>
                                            <th style="white-space: nowrap;">Rent. Atual <small>(ano)</small></th>
                                            <th style="white-space: nowrap;">Retorno Anual</th>
                                            <th style="white-space: nowrap;">Retorno Mensal</th>
                                            <th style="white-space: nowrap;">Patrimônio Máximo</th>
                                            <th style="white-space: nowrap;">Tempo <small>(anos)</small></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="px-3 bg-light text-right" style="white-space: nowrap;">
                                                <small>Atual</small>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_rentabilidade_Atual"
                                                       name="solucao_rentabilidade_Atual"
                                                       #solucao_rentabilidade_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.rentabilidade_Atual"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [allowNegativeNumbers]="true"
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoAnual_Atual"
                                                       name="solucao_retornoAnual_Atual"
                                                       #solucao_retornoAnual_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoAnual_Atual"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [allowNegativeNumbers]="true"
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoMensal_Atual"
                                                       name="solucao_retornoMensal_Atual"
                                                       #solucao_retornoMensal_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoMensal_Atual"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [allowNegativeNumbers]="true"
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_plMax_Atual"
                                                       name="solucao_plMax_Atual"
                                                       #solucao_plMax_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.plMax_Atual"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_idadeMax_Atual"
                                                       name="solucao_idadeMax_Atual"
                                                       #solucao_idadeMax_Atual="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.idadeMax_Atual"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [readOnly]="true">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 bg-light text-right" style="white-space: nowrap;">
                                                <small>Sugerida</small>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_rentabilidade_Sugerida"
                                                       name="solucao_rentabilidade_Sugerida"
                                                       #solucao_rentabilidade_Sugerida="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.rentabilidade_Sugerida"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="true"
                                                       suffix="%"
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoAnual_Sugerido"
                                                       name="solucao_retornoAnual_Sugerido"
                                                       #solucao_retornoAnual_Sugerido="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoAnual_Sugerido"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="true"
                                                       prefix="R$ "
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoMensal_Sugerido"
                                                       name="solucao_retornoMensal_Sugerido"
                                                       #solucao_retornoMensal_Sugerido="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoMensal_Sugerido"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [allowNegativeNumbers]="true"
                                                       prefix="R$ "
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_plMax_Sugerido"
                                                       name="solucao_plMax_Sugerido"
                                                       #solucao_plMax_Sugerido="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.plMax_Sugerido"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_idadeMax_Sugerido"
                                                       name="solucao_idadeMax_Sugerido"
                                                       #solucao_idadeMax_Sugerido="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.idadeMax_Sugerido"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [readOnly]="true">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 bg-light text-right" style="white-space: nowrap;">
                                                <small>Diferença</small>
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_rentabilidade_Diferenca"
                                                       name="solucao_rentabilidade_Diferenca"
                                                       #solucao_rentabilidade_Diferenca="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.rentabilidade_Diferenca"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoAnual_Diferenca"
                                                       name="solucao_retornoAnual_Diferenca"
                                                       #solucao_retornoAnual_Diferenca="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoAnual_Diferenca"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                            <td>
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_retornoMensal_Diferenca"
                                                       name="solucao_retornoMensal_Diferenca"
                                                       #solucao_retornoMensal_Diferenca="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.retornoMensal_Diferenca"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                            <td class="border-primary border-left border-top">
                                                <!-- {{planner.planejamentoAgregandoValor!.plMax_Diferenca}} <br> -->
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_plMax_Diferenca"
                                                       name="solucao_plMax_Diferenca"
                                                       #solucao_plMax_Diferenca="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.plMax_Diferenca"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       prefix="R$ "
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                            <td class="border-primary border">
                                                <input type="text"
                                                       class="form-control"
                                                       id="solucao_idadeMax_Diferenca"
                                                       name="solucao_idadeMax_Diferenca"
                                                       #solucao_idadeMax_Diferenca="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.idadeMax_Diferenca"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 bg-light text-right" style="white-space: nowrap;">
                                            </td>
                                            <td class="px-3 bg-light text-center" style="white-space: nowrap;" colspan="2">
                                                <span><b>Melhora de Desempenho</b></span>
                                            </td>
                                            <td class="px-3 bg-light text-left">
                                                <span>
                                                    <fa-icon [icon]="faArrowRight"></fa-icon>
                                                </span>
                                            </td>
                                            <td class="border-primary border-left border-bottom">
                                                <input type="text"
                                                       class="form-control h2 mb-0 font-weight-bold"
                                                       style="font-size: 20px"
                                                       id="solucao_pL_Desempenho"
                                                       name="solucao_pL_Desempenho"
                                                       #solucao_pL_Desempenho="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.pL_Desempenho"
                                                       mask="separator.2"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       suffix="%"
                                                       [readOnly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                            <td class="border-primary border">
                                                <input type="text"
                                                       class="form-control h2 mb-0 font-weight-bold"
                                                       style="font-size: 20px"
                                                       id="solucao_idade_Desempenho"
                                                       name="solucao_idade_Desempenho"
                                                       #solucao_idade_Desempenho="ngModel"
                                                       [(ngModel)]="planner.planejamentoAgregandoValor!.idade_Desempenho"
                                                       mask="separator.2"
                                                       suffix="%"
                                                       thousandSeparator="."
                                                       decimalMarker=","
                                                       [readonly]="true"
                                                       [allowNegativeNumbers]="true">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Patrimônio por Idade -->
                    <div class="form-row mb-2" *ngIf="planner.planejamentoGrafico.length > 0">
                        <app-patrimonio-por-idade style="width: 100%" [planner]="planner"></app-patrimonio-por-idade>
                    </div>
                    <!-- Comparativo Investimento x Produto -->
                    <div class="form-row mb-2" *ngIf="planner.planejamentoProduto.length > 0 && planner.planejamentoInvestimento.length > 0">
                        <app-grafico-comparativo style="width: 100%" #investimentoGraficos [planner]="planner"></app-grafico-comparativo>
                    </div>
                </div>
            </div>
            <div class="form-footer-submit-fixed">
                <div>
                    <div *ngIf="erro.length > 0 || form.invalid || !formIsValid" class="m-0">
                        <p class="text-danger" *ngFor="let err of erro">{{err | json}}</p>
                        <p *ngIf="erro.length == 0" class="text-danger">Preencha todos os campos corretamente para salvar</p>
                        <p class="text-danger" *ngIf="form.errors">{{form.errors | json}}</p>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mr-0 ml-auto" *ngIf="form.valid && formIsValid" [disabled]="loading">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                    <span>Salvar</span>
                </button>
            </div>
        </form>
        <ng-template #campoObrigatorio>
            <div class="py-2 px-2 text-danger"> Este campo é obrigatório </div>
        </ng-template>
    </div>
</div>
<router-outlet></router-outlet>